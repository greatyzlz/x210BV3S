<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Linux 驱动听课笔记</title>
  <style>
  @font-face {
  font-family: octicons-link;
  src: url(data:font/woff;charset=utf-8;base64,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) format('woff');
}

.markdown-body .octicon {
  display: inline-block;
  fill: currentColor;
  vertical-align: text-bottom;
}

.markdown-body .anchor {
  float: left;
  line-height: 1;
  margin-left: -20px;
  padding-right: 4px;
}

.markdown-body .anchor:focus {
  outline: none;
}

.markdown-body h1 .octicon-link,
.markdown-body h2 .octicon-link,
.markdown-body h3 .octicon-link,
.markdown-body h4 .octicon-link,
.markdown-body h5 .octicon-link,
.markdown-body h6 .octicon-link {
  color: #1b1f23;
  vertical-align: middle;
  visibility: hidden;
}

.markdown-body h1:hover .anchor,
.markdown-body h2:hover .anchor,
.markdown-body h3:hover .anchor,
.markdown-body h4:hover .anchor,
.markdown-body h5:hover .anchor,
.markdown-body h6:hover .anchor {
  text-decoration: none;
}

.markdown-body h1:hover .anchor .octicon-link,
.markdown-body h2:hover .anchor .octicon-link,
.markdown-body h3:hover .anchor .octicon-link,
.markdown-body h4:hover .anchor .octicon-link,
.markdown-body h5:hover .anchor .octicon-link,
.markdown-body h6:hover .anchor .octicon-link {
  visibility: visible;
}

.markdown-body {
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
  color: #24292e;
  line-height: 1.5;
  font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;
  font-size: 16px;
  line-height: 1.5;
  word-wrap: break-word;
}

.markdown-body .pl-c {
  color: #6a737d;
}

.markdown-body .pl-c1,
.markdown-body .pl-s .pl-v {
  color: #005cc5;
}

.markdown-body .pl-e,
.markdown-body .pl-en {
  color: #6f42c1;
}

.markdown-body .pl-s .pl-s1,
.markdown-body .pl-smi {
  color: #24292e;
}

.markdown-body .pl-ent {
  color: #22863a;
}

.markdown-body .pl-k {
  color: #d73a49;
}

.markdown-body .pl-pds,
.markdown-body .pl-s,
.markdown-body .pl-s .pl-pse .pl-s1,
.markdown-body .pl-sr,
.markdown-body .pl-sr .pl-cce,
.markdown-body .pl-sr .pl-sra,
.markdown-body .pl-sr .pl-sre {
  color: #032f62;
}

.markdown-body .pl-smw,
.markdown-body .pl-v {
  color: #e36209;
}

.markdown-body .pl-bu {
  color: #b31d28;
}

.markdown-body .pl-ii {
  background-color: #b31d28;
  color: #fafbfc;
}

.markdown-body .pl-c2 {
  background-color: #d73a49;
  color: #fafbfc;
}

.markdown-body .pl-c2:before {
  content: "^M";
}

.markdown-body .pl-sr .pl-cce {
  color: #22863a;
  font-weight: 700;
}

.markdown-body .pl-ml {
  color: #735c0f;
}

.markdown-body .pl-mh,
.markdown-body .pl-mh .pl-en,
.markdown-body .pl-ms {
  color: #005cc5;
  font-weight: 700;
}

.markdown-body .pl-mi {
  color: #24292e;
  font-style: italic;
}

.markdown-body .pl-mb {
  color: #24292e;
  font-weight: 700;
}

.markdown-body .pl-md {
  background-color: #ffeef0;
  color: #b31d28;
}

.markdown-body .pl-mi1 {
  background-color: #f0fff4;
  color: #22863a;
}

.markdown-body .pl-mc {
  background-color: #ffebda;
  color: #e36209;
}

.markdown-body .pl-mi2 {
  background-color: #005cc5;
  color: #f6f8fa;
}

.markdown-body .pl-mdr {
  color: #6f42c1;
  font-weight: 700;
}

.markdown-body .pl-ba {
  color: #586069;
}

.markdown-body .pl-sg {
  color: #959da5;
}

.markdown-body .pl-corl {
  color: #032f62;
  text-decoration: underline;
}

.markdown-body details {
  display: block;
}

.markdown-body summary {
  display: list-item;
}

.markdown-body a {
  background-color: transparent;
}

.markdown-body a:active,
.markdown-body a:hover {
  outline-width: 0;
}

.markdown-body strong {
  font-weight: inherit;
  font-weight: bolder;
}

.markdown-body h1 {
  font-size: 2em;
  margin: .67em 0;
}

.markdown-body img {
  border-style: none;
}

.markdown-body code,
.markdown-body kbd,
.markdown-body pre {
  font-family: monospace,monospace;
  font-size: 1em;
}

.markdown-body hr {
  box-sizing: content-box;
  height: 0;
  overflow: visible;
}

.markdown-body input {
  font: inherit;
  margin: 0;
}

.markdown-body input {
  overflow: visible;
}

.markdown-body [type=checkbox] {
  box-sizing: border-box;
  padding: 0;
}

.markdown-body * {
  box-sizing: border-box;
}

.markdown-body input {
  font-family: inherit;
  font-size: inherit;
  line-height: inherit;
}

.markdown-body a {
  color: #0366d6;
  text-decoration: none;
}

.markdown-body a:hover {
  text-decoration: underline;
}

.markdown-body strong {
  font-weight: 600;
}

.markdown-body hr {
  background: transparent;
  border: 0;
  border-bottom: 1px solid #dfe2e5;
  height: 0;
  margin: 15px 0;
  overflow: hidden;
}

.markdown-body hr:before {
  content: "";
  display: table;
}

.markdown-body hr:after {
  clear: both;
  content: "";
  display: table;
}

.markdown-body table {
  border-collapse: collapse;
  border-spacing: 0;
}

.markdown-body td,
.markdown-body th {
  padding: 0;
}

.markdown-body details summary {
  cursor: pointer;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-bottom: 0;
  margin-top: 0;
}

.markdown-body h1 {
  font-size: 32px;
}

.markdown-body h1,
.markdown-body h2 {
  font-weight: 600;
}

.markdown-body h2 {
  font-size: 24px;
}

.markdown-body h3 {
  font-size: 20px;
}

.markdown-body h3,
.markdown-body h4 {
  font-weight: 600;
}

.markdown-body h4 {
  font-size: 16px;
}

.markdown-body h5 {
  font-size: 14px;
}

.markdown-body h5,
.markdown-body h6 {
  font-weight: 600;
}

.markdown-body h6 {
  font-size: 12px;
}

.markdown-body p {
  margin-bottom: 10px;
  margin-top: 0;
}

.markdown-body blockquote {
  margin: 0;
}

.markdown-body ol,
.markdown-body ul {
  margin-bottom: 0;
  margin-top: 0;
  padding-left: 0;
}

.markdown-body ol ol,
.markdown-body ul ol {
  list-style-type: lower-roman;
}

.markdown-body ol ol ol,
.markdown-body ol ul ol,
.markdown-body ul ol ol,
.markdown-body ul ul ol {
  list-style-type: lower-alpha;
}

.markdown-body dd {
  margin-left: 0;
}

.markdown-body code,
.markdown-body pre {
  font-family: SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;
  font-size: 12px;
}

.markdown-body pre {
  margin-bottom: 0;
  margin-top: 0;
}

.markdown-body input::-webkit-inner-spin-button,
.markdown-body input::-webkit-outer-spin-button {
  -webkit-appearance: none;
  appearance: none;
  margin: 0;
}

.markdown-body .border {
  border: 1px solid #e1e4e8!important;
}

.markdown-body .border-0 {
  border: 0!important;
}

.markdown-body .border-bottom {
  border-bottom: 1px solid #e1e4e8!important;
}

.markdown-body .rounded-1 {
  border-radius: 3px!important;
}

.markdown-body .bg-white {
  background-color: #fff!important;
}

.markdown-body .bg-gray-light {
  background-color: #fafbfc!important;
}

.markdown-body .text-gray-light {
  color: #6a737d!important;
}

.markdown-body .mb-0 {
  margin-bottom: 0!important;
}

.markdown-body .my-2 {
  margin-bottom: 8px!important;
  margin-top: 8px!important;
}

.markdown-body .pl-0 {
  padding-left: 0!important;
}

.markdown-body .py-0 {
  padding-bottom: 0!important;
  padding-top: 0!important;
}

.markdown-body .pl-1 {
  padding-left: 4px!important;
}

.markdown-body .pl-2 {
  padding-left: 8px!important;
}

.markdown-body .py-2 {
  padding-bottom: 8px!important;
  padding-top: 8px!important;
}

.markdown-body .pl-3,
.markdown-body .px-3 {
  padding-left: 16px!important;
}

.markdown-body .px-3 {
  padding-right: 16px!important;
}

.markdown-body .pl-4 {
  padding-left: 24px!important;
}

.markdown-body .pl-5 {
  padding-left: 32px!important;
}

.markdown-body .pl-6 {
  padding-left: 40px!important;
}

.markdown-body .f6 {
  font-size: 12px!important;
}

.markdown-body .lh-condensed {
  line-height: 1.25!important;
}

.markdown-body .text-bold {
  font-weight: 600!important;
}

.markdown-body:before {
  content: "";
  display: table;
}

.markdown-body:after {
  clear: both;
  content: "";
  display: table;
}

.markdown-body>:first-child {
  margin-top: 0!important;
}

.markdown-body>:last-child {
  margin-bottom: 0!important;
}

.markdown-body a:not([href]) {
  color: inherit;
  text-decoration: none;
}

.markdown-body blockquote,
.markdown-body dl,
.markdown-body ol,
.markdown-body p,
.markdown-body pre,
.markdown-body table,
.markdown-body ul {
  margin-bottom: 16px;
  margin-top: 0;
}

.markdown-body hr {
  background-color: #e1e4e8;
  border: 0;
  height: .25em;
  margin: 24px 0;
  padding: 0;
}

.markdown-body blockquote {
  border-left: .25em solid #dfe2e5;
  color: #6a737d;
  padding: 0 1em;
}

.markdown-body blockquote>:first-child {
  margin-top: 0;
}

.markdown-body blockquote>:last-child {
  margin-bottom: 0;
}

.markdown-body kbd {
  background-color: #fafbfc;
  border: 1px solid #c6cbd1;
  border-bottom-color: #959da5;
  border-radius: 3px;
  box-shadow: inset 0 -1px 0 #959da5;
  color: #444d56;
  display: inline-block;
  font-size: 11px;
  line-height: 10px;
  padding: 3px 5px;
  vertical-align: middle;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  font-weight: 600;
  line-height: 1.25;
  margin-bottom: 16px;
  margin-top: 24px;
}

.markdown-body h1 {
  font-size: 2em;
}

.markdown-body h1,
.markdown-body h2 {
  border-bottom: 1px solid #eaecef;
  padding-bottom: .3em;
}

.markdown-body h2 {
  font-size: 1.5em;
}

.markdown-body h3 {
  font-size: 1.25em;
}

.markdown-body h4 {
  font-size: 1em;
}

.markdown-body h5 {
  font-size: .875em;
}

.markdown-body h6 {
  color: #6a737d;
  font-size: .85em;
}

.markdown-body ol,
.markdown-body ul {
  padding-left: 2em;
}

.markdown-body ol ol,
.markdown-body ol ul,
.markdown-body ul ol,
.markdown-body ul ul {
  margin-bottom: 0;
  margin-top: 0;
}

.markdown-body li {
  word-wrap: break-all;
}

.markdown-body li>p {
  margin-top: 16px;
}

.markdown-body li+li {
  margin-top: .25em;
}

.markdown-body dl {
  padding: 0;
}

.markdown-body dl dt {
  font-size: 1em;
  font-style: italic;
  font-weight: 600;
  margin-top: 16px;
  padding: 0;
}

.markdown-body dl dd {
  margin-bottom: 16px;
  padding: 0 16px;
}

.markdown-body table {
  display: block;
  overflow: auto;
  width: 100%;
}

.markdown-body table th {
  font-weight: 600;
}

.markdown-body table td,
.markdown-body table th {
  border: 1px solid #dfe2e5;
  padding: 6px 13px;
}

.markdown-body table tr {
  background-color: #fff;
  border-top: 1px solid #c6cbd1;
}

.markdown-body table tr:nth-child(2n) {
  background-color: #f6f8fa;
}

.markdown-body img {
  background-color: #fff;
  box-sizing: content-box;
  max-width: 100%;
}

.markdown-body img[align=right] {
  padding-left: 20px;
}

.markdown-body img[align=left] {
  padding-right: 20px;
}

.markdown-body code {
  background-color: rgba(27,31,35,.05);
  border-radius: 3px;
  font-size: 85%;
  margin: 0;
  padding: .2em .4em;
}

.markdown-body pre {
  word-wrap: normal;
}

.markdown-body pre>code {
  background: transparent;
  border: 0;
  font-size: 100%;
  margin: 0;
  padding: 0;
  white-space: pre;
  word-break: normal;
}

.markdown-body .highlight {
  margin-bottom: 16px;
}

.markdown-body .highlight pre {
  margin-bottom: 0;
  word-break: normal;
}

.markdown-body .highlight pre,
.markdown-body pre {
  background-color: #f6f8fa;
  border-radius: 3px;
  font-size: 85%;
  line-height: 1.45;
  overflow: auto;
  padding: 16px;
}

.markdown-body pre code {
  background-color: transparent;
  border: 0;
  display: inline;
  line-height: inherit;
  margin: 0;
  max-width: auto;
  overflow: visible;
  padding: 0;
  word-wrap: normal;
}

.markdown-body .commit-tease-sha {
  color: #444d56;
  display: inline-block;
  font-family: SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;
  font-size: 90%;
}

.markdown-body .blob-wrapper {
  border-bottom-left-radius: 3px;
  border-bottom-right-radius: 3px;
  overflow-x: auto;
  overflow-y: hidden;
}

.markdown-body .blob-wrapper-embedded {
  max-height: 240px;
  overflow-y: auto;
}

.markdown-body .blob-num {
  -moz-user-select: none;
  -ms-user-select: none;
  -webkit-user-select: none;
  color: rgba(27,31,35,.3);
  cursor: pointer;
  font-family: SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;
  font-size: 12px;
  line-height: 20px;
  min-width: 50px;
  padding-left: 10px;
  padding-right: 10px;
  text-align: right;
  user-select: none;
  vertical-align: top;
  white-space: nowrap;
  width: 1%;
}

.markdown-body .blob-num:hover {
  color: rgba(27,31,35,.6);
}

.markdown-body .blob-num:before {
  content: attr(data-line-number);
}

.markdown-body .blob-code {
  line-height: 20px;
  padding-left: 10px;
  padding-right: 10px;
  position: relative;
  vertical-align: top;
}

.markdown-body .blob-code-inner {
  color: #24292e;
  font-family: SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;
  font-size: 12px;
  overflow: visible;
  white-space: pre;
  word-wrap: normal;
}

.markdown-body .pl-token.active,
.markdown-body .pl-token:hover {
  background: #ffea7f;
  cursor: pointer;
}

.markdown-body kbd {
  background-color: #fafbfc;
  border: 1px solid #d1d5da;
  border-bottom-color: #c6cbd1;
  border-radius: 3px;
  box-shadow: inset 0 -1px 0 #c6cbd1;
  color: #444d56;
  display: inline-block;
  font: 11px SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;
  line-height: 10px;
  padding: 3px 5px;
  vertical-align: middle;
}

.markdown-body :checked+.radio-label {
  border-color: #0366d6;
  position: relative;
  z-index: 1;
}

.markdown-body .tab-size[data-tab-size="1"] {
  -moz-tab-size: 1;
  tab-size: 1;
}

.markdown-body .tab-size[data-tab-size="2"] {
  -moz-tab-size: 2;
  tab-size: 2;
}

.markdown-body .tab-size[data-tab-size="3"] {
  -moz-tab-size: 3;
  tab-size: 3;
}

.markdown-body .tab-size[data-tab-size="4"] {
  -moz-tab-size: 4;
  tab-size: 4;
}

.markdown-body .tab-size[data-tab-size="5"] {
  -moz-tab-size: 5;
  tab-size: 5;
}

.markdown-body .tab-size[data-tab-size="6"] {
  -moz-tab-size: 6;
  tab-size: 6;
}

.markdown-body .tab-size[data-tab-size="7"] {
  -moz-tab-size: 7;
  tab-size: 7;
}

.markdown-body .tab-size[data-tab-size="8"] {
  -moz-tab-size: 8;
  tab-size: 8;
}

.markdown-body .tab-size[data-tab-size="9"] {
  -moz-tab-size: 9;
  tab-size: 9;
}

.markdown-body .tab-size[data-tab-size="10"] {
  -moz-tab-size: 10;
  tab-size: 10;
}

.markdown-body .tab-size[data-tab-size="11"] {
  -moz-tab-size: 11;
  tab-size: 11;
}

.markdown-body .tab-size[data-tab-size="12"] {
  -moz-tab-size: 12;
  tab-size: 12;
}

.markdown-body .task-list-item {
  list-style-type: none;
}

.markdown-body .task-list-item+.task-list-item {
  margin-top: 3px;
}

.markdown-body .task-list-item input {
  margin: 0 .2em .25em -1.6em;
  vertical-align: middle;
}

.markdown-body hr {
  border-bottom-color: #eee;
}

.markdown-body .pl-0 {
  padding-left: 0!important;
}

.markdown-body .pl-1 {
  padding-left: 4px!important;
}

.markdown-body .pl-2 {
  padding-left: 8px!important;
}

.markdown-body .pl-3 {
  padding-left: 16px!important;
}

.markdown-body .pl-4 {
  padding-left: 24px!important;
}

.markdown-body .pl-5 {
  padding-left: 32px!important;
}

.markdown-body .pl-6 {
  padding-left: 40px!important;
}

.markdown-body .pl-7 {
  padding-left: 48px!important;
}

.markdown-body .pl-8 {
  padding-left: 64px!important;
}

.markdown-body .pl-9 {
  padding-left: 80px!important;
}

.markdown-body .pl-10 {
  padding-left: 96px!important;
}

.markdown-body .pl-11 {
  padding-left: 112px!important;
}

.markdown-body .pl-12 {
  padding-left: 128px!important;
}

/*# sourceURL=webpack://./node_modules/github-markdown-css/github-markdown.css */
/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL25vZGVfbW9kdWxlcy9naXRodWItbWFya2Rvd24tY3NzL2dpdGh1Yi1tYXJrZG93bi5jc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDRSwwQkFBMEI7RUFDMUIsMkRBQXF0RTtBQUN2dEU7O0FBRUE7RUFDRSxxQkFBcUI7RUFDckIsa0JBQWtCO0VBQ2xCLDJCQUEyQjtBQUM3Qjs7QUFFQTtFQUNFLFdBQVc7RUFDWCxjQUFjO0VBQ2Qsa0JBQWtCO0VBQ2xCLGtCQUFrQjtBQUNwQjs7QUFFQTtFQUNFLGFBQWE7QUFDZjs7QUFFQTs7Ozs7O0VBTUUsY0FBYztFQUNkLHNCQUFzQjtFQUN0QixrQkFBa0I7QUFDcEI7O0FBRUE7Ozs7OztFQU1FLHFCQUFxQjtBQUN2Qjs7QUFFQTs7Ozs7O0VBTUUsbUJBQW1CO0FBQ3JCOztBQUVBO0VBQ0UsMEJBQTBCO0VBQzFCLDhCQUE4QjtFQUM5QixjQUFjO0VBQ2QsZ0JBQWdCO0VBQ2hCLGtJQUFrSTtFQUNsSSxlQUFlO0VBQ2YsZ0JBQWdCO0VBQ2hCLHFCQUFxQjtBQUN2Qjs7QUFFQTtFQUNFLGNBQWM7QUFDaEI7O0FBRUE7O0VBRUUsY0FBYztBQUNoQjs7QUFFQTs7RUFFRSxjQUFjO0FBQ2hCOztBQUVBOztFQUVFLGNBQWM7QUFDaEI7O0FBRUE7RUFDRSxjQUFjO0FBQ2hCOztBQUVBO0VBQ0UsY0FBYztBQUNoQjs7QUFFQTs7Ozs7OztFQU9FLGNBQWM7QUFDaEI7O0FBRUE7O0VBRUUsY0FBYztBQUNoQjs7QUFFQTtFQUNFLGNBQWM7QUFDaEI7O0FBRUE7RUFDRSx5QkFBeUI7RUFDekIsY0FBYztBQUNoQjs7QUFFQTtFQUNFLHlCQUF5QjtFQUN6QixjQUFjO0FBQ2hCOztBQUVBO0VBQ0UsYUFBYTtBQUNmOztBQUVBO0VBQ0UsY0FBYztFQUNkLGdCQUFnQjtBQUNsQjs7QUFFQTtFQUNFLGNBQWM7QUFDaEI7O0FBRUE7OztFQUdFLGNBQWM7RUFDZCxnQkFBZ0I7QUFDbEI7O0FBRUE7RUFD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 */
  </style>
  <style>
  /**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */

code[class*="language-"],
pre[class*="language-"] {
	color: black;
	background: none;
	text-shadow: 0 1px white;
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
	text-shadow: none;
	background: #b3d4fc;
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
	text-shadow: none;
	background: #b3d4fc;
}

@media print {
	code[class*="language-"],
	pre[class*="language-"] {
		text-shadow: none;
	}
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #f5f2f0;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: slategray;
}

.token.punctuation {
	color: #999;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
	color: #905;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #690;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
	color: #9a6e3a;
	/* This background color was intended by the author of this theme. */
	background: hsla(0, 0%, 100%, .5);
}

.token.atrule,
.token.attr-value,
.token.keyword {
	color: #07a;
}

.token.function,
.token.class-name {
	color: #DD4A68;
}

.token.regex,
.token.important,
.token.variable {
	color: #e90;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}

/*# sourceURL=webpack://./node_modules/prismjs/themes/prism.css */
/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL25vZGVfbW9kdWxlcy9wcmlzbWpzL3RoZW1lcy9wcmlzbS5jc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7RUFJRTs7QUFFRjs7Q0FFQyxZQUFZO0NBQ1osZ0JBQWdCO0NBQ2hCLHdCQUF3QjtDQUN4QixzRUFBc0U7Q0FDdEUsY0FBYztDQUNkLGdCQUFnQjtDQUNoQixnQkFBZ0I7Q0FDaEIsb0JBQW9CO0NBQ3BCLGtCQUFrQjtDQUNsQixpQkFBaUI7Q0FDakIsZ0JBQWdCOztDQUVoQixnQkFBZ0I7Q0FDaEIsY0FBYztDQUNkLFdBQVc7O0NBRVgscUJBQXFCO0NBQ3JCLGtCQUFrQjtDQUNsQixpQkFBaUI7Q0FDakIsYUFBYTtBQUNkOztBQUVBOztDQUVDLGlCQUFpQjtDQUNqQixtQkFBbUI7QUFDcEI7O0FBRUE7O0NBRUMsaUJBQWlCO0NBQ2pCLG1CQUFtQjtBQUNwQjs7QUFFQTtDQUNDOztFQUVDLGlCQUFpQjtDQUNsQjtBQUNEOztBQUVBLGdCQUFnQjtBQUNoQjtDQUNDLFlBQVk7Q0FDWixjQUFjO0NBQ2QsY0FBYztBQUNmOztBQUVBOztDQUVDLG1CQUFtQjtBQUNwQjs7QUFFQSxnQkFBZ0I7QUFDaEI7Q0FDQyxhQUFhO0NBQ2IsbUJBQW1CO0NBQ25CLG1CQUFtQjtBQUNwQjs7QUFFQTs7OztDQUlDLGdCQUFnQjtBQUNqQjs7QUFFQTtDQUNDLFdBQVc7QUFDWjs7QUFFQTtDQUNDLFdBQVc7QUFDWjs7QUFFQTs7Ozs7OztDQU9DLFdBQVc7QUFDWjs7QUFFQTs7Ozs7O0NBTUMsV0FBVztBQUNaOztBQUVBOzs7OztDQUtDLGNBQWM7Q0FDZCxvRUFBb0U7Q0FDcEUsaUNBQWlDO0FBQ2xDOztBQUVBOzs7Q0FHQyxXQUFXO0FBQ1o7O0FBRUE7O0NBRUMsY0FBYztBQUNmOztBQUVBOzs7Q0FHQyxXQUFXO0FBQ1o7O0FBRUE7O0NBRUMsaUJBQWlCO0FBQ2xCO0FBQ0E7Q0FDQyxrQkFBa0I7QUFDbkI7O0FBRUE7Q0FDQyxZQUFZO0FBQ2IiLCJzb3VyY2VSb290IjoiIn0= */
  </style>
  <style>
  
  </style>
  <style>
    .markdown-body {
      font-family: -apple-system,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;
      box-sizing: border-box;
      min-width: 200px;
      max-width: 980px;
      margin: 0 auto;
      padding: 45px;
    }

    @media not print {
      .markdown-body {
        padding: 45px;
      }

      @media (max-width: 767px) {
        .markdown-body {
          padding: 15px;
        }
      }
    }

    .hf-container {
      color: #24292e;
      line-height: 1.3;
    }

    .markdown-body .highlight pre,
    .markdown-body pre {
      white-space: pre-wrap;
    }
    .markdown-body table {
      display: table;
    }
    .markdown-body img[data-align="center"] {
      display: block;
      margin: 0 auto;
    }
    .markdown-body img[data-align="right"] {
      display: block;
      margin: 0 0 0 auto;
    }
    .markdown-body li.task-list-item {
      list-style-type: none;
    }
    .markdown-body li > [type=checkbox] {
      margin: 0 0 0 -1.3em;
    }
    .markdown-body input[type="checkbox"] ~ p {
      margin-top: 0;
      display: inline-block;
    }
    .markdown-body ol ol,
    .markdown-body ul ol {
      list-style-type: decimal;
    }
    .markdown-body ol ol ol,
    .markdown-body ol ul ol,
    .markdown-body ul ol ol,
    .markdown-body ul ul ol {
      list-style-type: decimal;
    }
  </style>
  <style>.markdown-body a.footnote-ref {
  text-decoration: none;
}

.footnotes {
  font-size: .85em;
  opacity: .8;
}

.footnotes li[role="doc-endnote"] {
  position: relative;
}

.footnotes .footnote-back {
  position: absolute;
  font-family: initial;
  top: .2em;
  right: 1em;
  text-decoration: none;
}

.inline-math.invalid,
.multiple-math.invalid {
  color: rgb(255, 105, 105);
}

.toc-container {
  width: 100%;
}

.toc-container .toc-title {
  font-weight: 700;
  font-size: 1.2em;
  margin-bottom: 0;
}

.toc-container li,
.toc-container ul,
.toc-container ul li {
  list-style: none !important;
}

.toc-container > ul {
  padding-left: 0;
}

.toc-container ul li span {
  display : flex;
}

.toc-container ul li span a {
  color: inherit;
  text-decoration: none;
}
.toc-container ul li span a:hover {
  color: inherit;
  text-decoration: none;
}

.toc-container ul li span span.dots {
  flex: 1;
  height: 0.65em;
  margin: 0 10px;
  border-bottom: 2px dotted black;
}

/*# sourceURL=webpack://./src/muya/lib/assets/styles/exportStyle.css */
/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9tdXlhL2xpYi9hc3NldHMvc3R5bGVzL2V4cG9ydFN0eWxlLmNzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNFLHFCQUFxQjtBQUN2Qjs7QUFFQTtFQUNFLGdCQUFnQjtFQUNoQixXQUFXO0FBQ2I7O0FBRUE7RUFDRSxrQkFBa0I7QUFDcEI7O0FBRUE7RUFDRSxrQkFBa0I7RUFDbEIsb0JBQW9CO0VBQ3BCLFNBQVM7RUFDVCxVQUFVO0VBQ1YscUJBQXFCO0FBQ3ZCOztBQUVBOztFQUVFLHlCQUF5QjtBQUMzQjs7QUFFQTtFQUNFLFdBQVc7QUFDYjs7QUFFQTtFQUNFLGdCQUFnQjtFQUNoQixnQkFBZ0I7RUFDaEIsZ0JBQWdCO0FBQ2xCOztBQUVBOzs7RUFHRSwyQkFBMkI7QUFDN0I7O0FBRUE7RUFDRSxlQUFlO0FBQ2pCOztBQUVBO0VBQ0UsY0FBYztBQUNoQjs7QUFFQTtFQUNFLGNBQWM7RUFDZCxxQkFBcUI7QUFDdkI7QUFDQTtFQUNFLGNBQWM7RUFDZCxxQkFBcUI7QUFDdkI7O0FBRUE7RUFDRSxPQUFPO0VBQ1AsY0FBYztFQUNkLGNBQWM7RUFDZCwrQkFBK0I7QUFDakMiLCJzb3VyY2VSb290IjoiIn0= */</style>
  <style>.markdown-body{}body {counter-reset: h2}
h2 {counter-reset: h3}
h3 {counter-reset: h4}
h4 {counter-reset: h5}
h5 {counter-reset: h6}
h2:before {counter-increment: h2; content: counter(h2) ". "}
h3:before {counter-increment: h3; content: counter(h2) "." counter(h3) ". "}
h4:before {counter-increment: h4; content: counter(h2) "." counter(h3) "." counter(h4) ". "}
h5:before {counter-increment: h5; content: counter(h2) "." counter(h3) "." counter(h4) "." counter(h5) ". "}
h6:before {counter-increment: h6; content: counter(h2) "." counter(h3) "." counter(h4) "." counter(h5) "." counter(h6) ". "}
h2.nocount:before, h3.nocount:before, h4.nocount:before, h5.nocount:before, h6.nocount:before { content: ""; counter-increment: none }.page-header .hf-container,
    .page-footer-fake .hf-container,
    .page-footer .hf-container {
      font-size: 12px;
    }</style>
</head>
<body>
  <article class="markdown-body"><div class="toc-container"><p class="toc-title">Table of Contents</p><ul class="toc-list"><li><span><a class="toc-h2" href="#第一天">第一天</a><span class="dots"></span></span><ul><li><span><a class="toc-h3" href="#1-内核源码的编译">1. 内核源码的编译</a><span class="dots"></span></span><ul><li><span><a class="toc-h4" href="#a-获取源码">a. 获取源码</a><span class="dots"></span></span></li><li><span><a class="toc-h4" href="#b-内核编译步骤">b. 内核编译步骤</a><span class="dots"></span></span></li></ul></li><li><span><a class="toc-h3" href="#2-编写驱动">2. 编写驱动</a><span class="dots"></span></span><ul><li><span><a class="toc-h4" href="#a-头文件">a. 头文件</a><span class="dots"></span></span></li><li><span><a class="toc-h4" href="#b-声明驱动模块的装载和卸载函数">b. 声明驱动模块的装载和卸载函数</a><span class="dots"></span></span></li><li><span><a class="toc-h4" href="#c-实现驱动模块的装载和卸载函数">c. 实现驱动模块的装载和卸载函数</a><span class="dots"></span></span></li><li><span><a class="toc-h4" href="#d-添加gpl认证">d. 添加GPL认证</a><span class="dots"></span></span></li><li><span><a class="toc-h4" href="#e-写makefile">e. 写Makefile</a><span class="dots"></span></span></li></ul></li><li><span><a class="toc-h3" href="#3-运行开发板">3. 运行开发板</a><span class="dots"></span></span></li><li><span><a class="toc-h3" href="#4-模块特性---ko">4. 模块特性---ko</a><span class="dots"></span></span><ul><li><span><a class="toc-h4" href="#a-模块传参">a. 模块传参</a><span class="dots"></span></span></li><li><span><a class="toc-h4" href="#b-模块调用">b. 模块调用</a><span class="dots"></span></span></li></ul></li></ul></li><li><span><a class="toc-h2" href="#第二天">第二天</a><span class="dots"></span></span><ul><li><span><a class="toc-h3" href="#5-一个真正的设备驱动需要一些什么元素">5. 一个真正的设备驱动需要一些什么元素</a><span class="dots"></span></span></li></ul></li><li><span><a class="toc-h2" href="#第三天">第三天</a><span class="dots"></span></span><ul><li><span><a class="toc-h3" href="#作业1">作业1</a><span class="dots"></span></span></li><li><span><a class="toc-h3" href="#作业2">作业2</a><span class="dots"></span></span></li><li><span><a class="toc-h3" href="#主要内容">主要内容</a><span class="dots"></span></span></li></ul></li><li><span><a class="toc-h2" href="#第四天">第四天</a><span class="dots"></span></span><ul><li><span><a class="toc-h4" href="#主要内容：">主要内容：</a><span class="dots"></span></span></li><li><span><a class="toc-h3" href="#1-多路复用">1. 多路复用</a><span class="dots"></span></span></li><li><span><a class="toc-h3" href="#2-mmap的实现">2. mmap的实现</a><span class="dots"></span></span></li><li><span><a class="toc-h3" href="#3-中断下半部的实现方式">3. 中断下半部的实现方式</a><span class="dots"></span></span></li></ul></li><li><span><a class="toc-h2" href="#第五天">第五天</a><span class="dots"></span></span><ul><li><span><a class="toc-h3" href="#主要内容：平台总线">主要内容：平台总线</a><span class="dots"></span></span></li><li><span><a class="toc-h3" href="#1-平台总线的作用">1. 平台总线的作用</a><span class="dots"></span></span></li><li><span><a class="toc-h3" href="#3-平台总线中的自定义数据">3. 平台总线中的自定义数据</a><span class="dots"></span></span></li><li><span><a class="toc-h3" href="#4-内核中的平台设备">4. 内核中的平台设备</a><span class="dots"></span></span></li></ul></li><li><span><a class="toc-h2" href="#第六天">第六天</a><span class="dots"></span></span><ul><li><span><a class="toc-h3" href="#主要内容：输入子系统编程---主要针对输入设备">主要内容：输入子系统编程---主要针对输入设备</a><span class="dots"></span></span></li><li><span><a class="toc-h3" href="#1-输入系统的作用和框架">1. 输入系统的作用和框架</a><span class="dots"></span></span></li></ul></li><li><span><a class="toc-h2" href="#第七天">第七天</a><span class="dots"></span></span><ul><li><span><a class="toc-h3" href="#主要内容-1">主要内容</a><span class="dots"></span></span></li><li><span><a class="toc-h3" href="#1-i2c协议讲解">1. i2c协议讲解</a><span class="dots"></span></span></li><li><span><a class="toc-h3" href="#2-i2c子系统框架">2. i2c子系统框架</a><span class="dots"></span></span></li><li><span><a class="toc-h3" href="#3-i2c子系统驱动编程--从设备at24c02">3. i2c子系统驱动编程--从设备at24c02</a><span class="dots"></span></span></li></ul></li><li><span><a class="toc-h2" href="#第八天-如何跟读内核代码">第八天 如何跟读内核代码</a><span class="dots"></span></span><ul><li><span><a class="toc-h3" href="#总结：">总结：</a><span class="dots"></span></span></li><li><span><a class="toc-h3" href="#lcd屏-framebuffer">LCD屏 FrameBuffer</a><span class="dots"></span></span></li><li><span><a class="toc-h3" href="#主要内容--framebuffer子系统--lcd屏驱动">主要内容--framebuffer子系统--lcd屏驱动</a><span class="dots"></span></span></li><li><span><a class="toc-h3" href="#1-framebuffer子系统的框架">1. FrameBuffer子系统的框架</a><span class="dots"></span></span></li><li><span><a class="toc-h3" href="#2-lcd屏的驱动移植">2. LCD屏的驱动移植</a><span class="dots"></span></span></li></ul></li><li><span><a class="toc-h2" href="#第九天-触摸屏">第九天 触摸屏</a><span class="dots"></span></span><ul><li><span><a class="toc-h3" href="#主要内容----电容触摸屏驱动">主要内容----电容触摸屏驱动</a><span class="dots"></span></span></li><li><span><a class="toc-h3" href="#驱动编程：">驱动编程：</a><span class="dots"></span></span></li><li><span><a class="toc-h3" href="#linux下多点触摸的协议">Linux下多点触摸的协议</a><span class="dots"></span></span></li></ul></li><li><span><a class="toc-h2" href="#第十天">第十天</a><span class="dots"></span></span><ul><li><span><a class="toc-h3" href="#主要内容---内核工作原理解析">主要内容---内核工作原理解析</a><span class="dots"></span></span></li><li><span><a class="toc-h3" href="#1-内核的编译步骤">1. 内核的编译步骤</a><span class="dots"></span></span></li><li><span><a class="toc-h3" href="#2-kconfig和makefile的使用">2. Kconfig和Makefile的使用</a><span class="dots"></span></span></li><li><span><a class="toc-h3" href="#3-内核的裁剪---make-menuconfig">3. 内核的裁剪---make menuconfig</a><span class="dots"></span></span></li><li><span><a class="toc-h3" href="#4-内核的工作原理">4. 内核的工作原理</a><span class="dots"></span></span></li></ul></li></ul></div><h2 class="atx" id="第一天">第一天</h2>
<h3 class="atx" id="1-内核源码的编译">1. 内核源码的编译</h3>
<h4 class="atx" id="a-获取源码">a. 获取源码</h4>
<pre><code class="indented-code-block">www.kernel.org</code></pre>
<h4 class="atx" id="b-内核编译步骤">b. 内核编译步骤</h4>
<p>略</p>
<h3 class="atx" id="2-编写驱动">2. 编写驱动</h3>
<h4 class="atx" id="a-头文件">a. 头文件</h4>
<pre><code class="indented-code-block">#include &lt;linux/init.h&gt;
#include &lt;linux/module.h&gt;</code></pre>
<h4 class="atx" id="b-声明驱动模块的装载和卸载函数">b. 声明驱动模块的装载和卸载函数</h4>
<pre><code class="indented-code-block">module_init(hello_init);
module_exit(hello_exit);</code></pre>
<h4 class="atx" id="c-实现驱动模块的装载和卸载函数">c. 实现驱动模块的装载和卸载函数</h4>
<h4 class="atx" id="d-添加gpl认证">d. 添加GPL认证</h4>
<pre><code class="indented-code-block">MODULE_LICENSE("GPL");
MODULE_AUTHOR("bot@qq.com"); //可选
MODULE_DESCRIPTION("ACPI EC sysfs access driver"); // 可选</code></pre>
<h4 class="atx" id="e-写makefile">e. 写Makefile</h4>
<pre><code class="indented-code-block">#内核源码路径
 KERNEL_DIR = /home/dwu/samba/linux-4.19.100

 #-C表示进入某个目录并执行该目录下的Makefile

 all:
     #表示进入内核目录， 并告诉内核要将当前源码编译成模块
     make -C $(KERNEL_DIR) M=$(CUR_DIR) module

 clean:
     make -C $(KERNEL_DIR) M=$(CUR_DIR) clean

 #指定编译哪个源文件
 obj-m = hello_drv.o</code></pre>
<h3 class="atx" id="3-运行开发板">3. 运行开发板</h3>
<p>前提是内核已经移植好</p>
<h3 class="atx" id="4-模块特性---ko">4. 模块特性---ko</h3>
<blockquote>
<p>模块传参<br>模块调用  </p>
</blockquote>
<h4 class="atx" id="a-模块传参">a. 模块传参</h4>
<pre><code class="indented-code-block">insmod hello_drv.ko number=250 name="ruhua"</code></pre>
<p>代码中需要增加：</p>
<pre><code class="indented-code-block">module_param(参数名, 参数类型, 权限(644));
module_param(number, int, 0644);</code></pre>
<p>其中0644为权限值，即为下面文件的权限</p>
<pre><code class="indented-code-block"># ls /sys/module/hello_drv_para/parameters/
name    number
-rw-r--r--    1 root     root        4.0K Jan  1 00:03 name
-rw-r--r--    1 root     root        4.0K Jan  1 00:03 number</code></pre>
<h4 class="atx" id="b-模块调用">b. 模块调用</h4>
<p>被调用的模块需要用EXPORT_SYMBOL导出  </p>
<pre><code class="indented-code-block">int add(int a, int b)
{
    return a+b;
}
EXPORT_SYMBOL(add);
MODULE_LICENSE("GPL");</code></pre>
<h2 class="atx" id="第二天">第二天</h2>
<h3 class="atx" id="5-一个真正的设备驱动需要一些什么元素">5. 一个真正的设备驱动需要一些什么元素</h3>
<p>o. 实例化全局的设备对象  </p>
<pre><code class="indented-code-block">/** 
 * @brief        分配内存
 * @param[1]    分配大小
 * @param[2]    分配标志---GFP_KERNEL表示如果当前暂时没有内存，会尝试等待
 * @param[3]    文件操作对象
 * @return        如果系统分配，返回设备号，否则返回负数错误
 */
led_dev = kzalloc(sizeof (struct s5pv210_led), GFP_KERNEL);</code></pre>
<p>a. 需要一个设备号  </p>
<blockquote>
<p>因为内核中有很多设备驱动，所以需要一个id来进行区分<br>设备号分为两个部分：<br>主设备号：某一类设备<br>此设备号：某类设备中的某个设备<br>例如：前置和后置摄像头都是camera这类设备，前置：0， 后置：1<br>在内核中：dev_t来表示设备号，为32bit的整数，高12bits：主设备号；低20bits：次设备号  </p>
</blockquote>
<pre><code class="indented-code-block">/** 
 * @brief        申请一个设备号
 * @param[1]    指定一个号码，填0表示由系统分配
 * @param[2]    字符串--描述设备驱动信息--自定义--/pro/devices文件中的名字
 * @param[3]    文件操作对象
 * @return        如果系统分配，返回设备号，否则返回负数错误
 */
int register_chrdev(unsigned int major, const char *name,
              const struct file_operations *fops)；

/** 
 * @brief        申请一个设备号
 * @param[1]    指定一个号码
 * @param[2]    字符串--描述设备驱动信息--自定义
 * @return        void
 */
void unregister_chrdev(unsigned int major, const char *name)；  </code></pre>
<p>b. 需要一个设备文件  </p>
<blockquote>
<p>linux中将所有的设备都看成是文件，操作设备其实就是操作文件；<br>设备文件称之为设备节点(/dev下面的文件)</p>
</blockquote>
<pre><code class="indented-code-block">ls -l /dev
crw-------    1 root     root      254,   0 Jan  1 00:00 gpiochip0
crw-------    1 root     root      254,   1 Jan  1 00:00 gpiochip1
crw-------    1 root     root      254,  10 Jan  1 00:00 gpiochip10
crw-------    1 root     root      254,  11 Jan  1 00:00 gpiochip11</code></pre>
<blockquote>
<p>如何创建设备节点：<br>1）手动创建：每次开机都要创建，/dev下面的节点斗在内存中</p>
</blockquote>
<pre><code class="indented-code-block">mknod 文件名      类型  主设备号  此设备号
mknod /dev/hello   c     250        0  </code></pre>
<ol start="2">
<li><p>自动创建 </p>
<p> /** </p>
<ul>
<li>@brief        创建一个类</li>
<li>@param[1]    当前模块---THIS_MODULE</li>
<li>@param[2]    字符串--表示类的名字</li>
<li>@return        struct class 指针类型
<em>/
struct class * class_create(owner, name);
销毁：class_destroy(led_dev-&gt;cls);
/*</em> </li>
<li>@brief        创建一个设备节点</li>
<li>@param[1]    class_create返回的指针</li>
<li>@param[2]    该设备的父类</li>
<li>@param[3]    设备号---包含了主设备号和次设备号MKDEV</li>
<li>@param[4]    私有数据---一般都填NULL</li>
<li>@param[5]    设备节点的名字 --- /dev/led</li>
<li>@return        struct class 指针类型
*/
struct device *device_create(struct class *class, struct device *parent, dev_t devt, void *drvdata, const char *fmt, ...);
销毁：device_destroy(led_dev-&gt;cls, MKDEV(led_dev-&gt;dev_major, 0));</li>
</ul>
</li>
</ol>
<p>c. 需要一个设备的操作方法  </p>
<blockquote>
<p>驱动：操作硬件，为应用服务<br>驱动提供功能，应用使用功能  </p>
</blockquote>
<pre><code class="indented-code-block">int hello_drv_open(struct inode * inode, struct file * filep)
{
    printk(KERN_INFO"--------^_^ %s-------\n", __FUNCTION__);
    return 0;
}

static struct file_operations hello_fops = {
    .open = hello_drv_open,
};</code></pre>
<blockquote>
<p>系统调用，会从用户空间陷入内核空间，操作系统通过软中断产生异常，跳到中断处理函数，实现空间切换，使用不同的中断号区分不同的系统调用，arm软中断指令为swi，x86软中断指令为int  </p>
</blockquote>
<pre><code class="indented-code-block">异常--&gt;处理--&gt;根据中断号调用--&gt;sys_xxx(open,write...)--&gt;区分调用哪个驱动的(open,write...)--&gt;根据注册的设备号、file_operations找到设备处理函数</code></pre>
<p>d. 初始化硬件  </p>
<pre><code class="indented-code-block">/** 
 * @brief        将物理地址转为虚拟地址
 * @param[1]    物理地址
 * @param[2]    映射长度
 * @return        映射后的虚拟地址
 */
gpj0_conf = ioremap(0xE0200240, 8);
iounmap(gpj0_conf);</code></pre>
<p>e. 应用空间和内核空间之间的数据交互  </p>
<pre><code class="indented-code-block">/** 
 * @brief        从用户空间获取数据，一般都用在驱动中的write函数的实现
 * @param[1]    目标地址---内核空间地址
 * @param[2]    源地址---用户空间的地址
 * @param[3]    拷贝数据个数
 * @return        没有拷贝成功的数据个数，所以成功返回0，出错返回大于0
 */
unsigned int copy_from_user(void * to, const void __user * from, unsigned long n);

/** 
 * @brief        将内核空间数据拷贝到用户空间，一般都用在驱动中的read函数的实现
 * @param[1]    目标地址---用户空间地址
 * @param[2]    源地址---内核空间的地址
 * @param[3]    拷贝数据个数
 * @return        没有拷贝成功的数据个数，所以成功返回0，出错返回大于0
 */
unsigned int copy_to_user(void __user * to, const void * from, unsigned long n);</code></pre>
<p>f. linux中ioctl的实现和gpio库函数的使用  </p>
<blockquote>
<p>如果需要给用户空间更多的api，可以添加一个ioctl接口：<br>ioctl()用于给驱动发送指令：某个灯亮，某个灯灭，全亮，全灭<br>应用空间：  </p>
</blockquote>
<pre><code class="indented-code-block">int ioctl(int fd, unsigned long cmd, ...);</code></pre>
<blockquote>
<p>驱动：</p>
</blockquote>
<pre><code class="indented-code-block">xxx_ioctl(int fd, unsigned long cmd, ...)
{
    switch(cmd)
    {
        case 命令1：
        ...
    }
}</code></pre>
<blockquote>
<p>命令如何定义：由程序员决定， 一定是一个整数</p>
</blockquote>
<p>1)直接用一个整数---可能与系统中已经存在的命令冲突 </p>
<pre><code class="indented-code-block">eg:
    #define LED_ALL_ON    0x2222
    #define LED_ALL_OFF    0x3333</code></pre>
<p>2)用内核提供接口来定义一个整数</p>
<pre><code class="indented-code-block">用户只传命令：_IO(type, nr)    //参数1：魔幻数(0-255)，参数2：唯一的数字
用户写数据到内核：_IOW(type, nr, size) //参数3：数据类型，可以是结构体
用户从内核读数据：_IOR(type, nr, size)
用户读写内核数据s：_IOWR(type, nr, size)    

eg:
    #define LED_NUM_ON    _IOW('L', 0x3456, int)
    #define LED_NUM_OFF    _IOW('L', 0x3457, int)
    #define LED_ALL_ON    _IO('L', 0x3458)
    #define LED_ALL_OFF    _IO('L', 0x3459)</code></pre>
<ol start="3">
<li>gpio库函数的使用:  </li>
</ol>
<p>(1) 直接操作gpio口对应的寄存器（先看原理图---数据手册---物理地址---ioremap）<br>(2) gpio库函数的接口  </p>
<pre><code class="indented-code-block">//申请gpio口
gpio_request(unsigned gpio, const char * label)；

//将某个gpio配置成输出功能
gpio_direction_intput(unsigned gpio, int value)；
//将某个gpio配置成输出功能，并直接输出高低电平
gpio_direction_output(unsigned gpio, int value)；
//获取gpio值
gpio_get_value
//设置gpio值
gpio_set_value
//通过gpio口获取到中断号码
gpio_to_irq
//释放
gpio_free(unsigned gpio)</code></pre>
<h2 class="atx" id="第三天">第三天</h2>
<h3 class="atx" id="作业1">作业1</h3>
<p>PC使用QT编写界面控制开发板led灯</p>
<h3 class="atx" id="作业2">作业2</h3>
<p>两开发板互相控制led</p>
<h3 class="atx" id="主要内容">主要内容</h3>
<ol>
<li>Linux中file，cdev，inode之间的关系  </li>
</ol>
<blockquote>
<p>struct file对象：描述进程中打开一个文件的信息：文件名，标志(可读写)，文件偏移   </p>
</blockquote>
<pre><code class="indented-code-block">open("/dev/led", O_RDWR, 0666);
struct file 
{
    struct path        f_path;
    struct inode        *f_inode;    /* cached value */
    const struct file_operations    *f_op;//文件操作对象
    ...
    unsigned int         f_flags;
    fmode_t            f_mode;
    struct mutex        f_pos_lock;
    loff_t            f_pos;
    struct fown_struct    f_owner;
    ...
    void            *private_data;//万能指针
    ...
}</code></pre>
<blockquote>
<p>struct cdev对象：描述一个字符设备对象(设备号+文件操作对象)，任何一个字符设备驱动，都有该对象, 一旦cdev被注册，就会将新建的cdev放在cdev_map全局变量中；   </p>
</blockquote>
<pre><code class="indented-code-block">struct cdev {
    struct kobject kobj;//基类
    struct module *owner;
    const struct file_operations *ops;//文件操作对象
    struct list_head list;//链表
    dev_t dev;//设备号
    unsigned int count;
} __randomize_layout;</code></pre>
<blockquote>
<p>struct inode对象：描述文件系统中的某个文件的信息(文件权限，类型，uid，gid，修改时间，大小等)；  </p>
</blockquote>
<pre><code class="indented-code-block">struct inode {
    umode_t            i_mode;//fstat查看文件状态
    unsigned short        i_opflags;
    kuid_t            i_uid;
    kgid_t            i_gid;

    ...
    dev_t            i_rdev;//设备号
    ...
    struct timespec64    i_atime;
    struct timespec64    i_mtime;
    struct timespec64    i_ctime;
    ...
    const struct file_operations    *i_fop;
    ...
}</code></pre>
<blockquote>
<p>三者关系</p>
</blockquote>
<pre><code class="indented-code-block">异常--&gt;处理--&gt;根据中断号调用--&gt;sys_xxx(open,write...)--&gt;区分调用哪个驱动的(open,write...)--&gt;根据注册的设备号、file_operations找到设备处理函数（参考图，自述）</code></pre>
<blockquote>
<p>设备驱动<br>register_chrdev(dev_no, fops)注册设备时会创建cdev，并将cdev中的设备号和fops初始化，放入vfs层的cdev链表</p>
</blockquote>
<ol start="2">
<li><p>新的注册字符设备的方式</p>
<p> cdev_alloc(void);<br> cdev_init(struct cdev * cdev, const struct file_operations * fops);<br> cdev_add(struct cdev *, dev_t, unsigned);  </p>
</li>
<li><p>中断申请</p>
<blockquote>
<p>中断控制器(vic)管理/筛选/设置中断优先级<br>最终中断由CPU处理（FIQ，IRQ）</p>
</blockquote>
</li>
</ol>
<p>中断操作函数，补--------------------</p>
<ol start="4">
<li><p>文件io模型实现之阻塞和非阻塞   </p>
<blockquote>
<p>默认情况下大部分都是阻塞模式：<br>阻塞函数：read, accept, read/recv/recvform    </p>
</blockquote>
</li>
</ol>
<blockquote>
<p>实现阻塞：<br>0,需要一个等待队列头</p>
</blockquote>
<pre><code class="indented-code-block">struct wait_queue_head {
spinlock_t        lock;
struct list_head    head;
};

init_waitqueue_head(&amp;key_dev-&gt;wq_head);</code></pre>
<blockquote>
<p>1,根据条件可以让进程进入休眠状态    </p>
</blockquote>
<pre><code class="indented-code-block">/** 
 * @brief        实现阻塞
 * @param[1]    表示等待队列头
 * @param[2]    表示一个条件---如果为假，就在此休眠，如果为真就不休眠
 * @return        映射后的虚拟地址
 */
wait_event_interruptible(wq_head, condition)  </code></pre>
<blockquote>
<p>2,资源可达进行唤醒  </p>
</blockquote>
<pre><code class="indented-code-block">wake_up_interruptible(x)  </code></pre>
<blockquote>
<p>非阻塞</p>
</blockquote>
<blockquote>
<p>在应用中设置非阻塞模式</p>
</blockquote>
<pre><code class="indented-code-block">open("/dev/key0", O_RDWR | O_NONBLOCK);</code></pre>
<blockquote>
<p>read() 有数据就得到数据，没有数据就得到一个出错码---EAGAIN。<br>驱动：需要区分阻塞还是非阻塞  </p>
</blockquote>
<pre><code class="indented-code-block">xxx_read
{
    需要区分阻塞还是非阻塞
}
if ((flp-&gt;f_flags &amp; O_NONBLOCK) &amp;&amp; !key_dev-&gt;have_data) //如果是非阻塞且没有数据
{
    return -EAGAIN;
}</code></pre>
<h2 class="atx" id="第四天">第四天</h2>
<h4 class="atx" id="主要内容：">主要内容：</h4>
<ol>
<li>多路复用的实现----等设备树学完回来再学这个，里面用到的中断，Linux4.19已经没有</li>
<li>mmap的实现</li>
<li>中断下半部的实现方式<ol>
<li>a，tasklet的实现</li>
<li>b, 工作队列的实现</li>
</ol>
</li>
</ol>
<blockquote>
<p>应用调用：</p>
</blockquote>
<pre><code class="indented-code-block">open()</code></pre>
<p>vfs：
    搜索SYSCALL_DEFINE3
    sys_open() ---fs/open.c
    {
        do_sys_open(AT_FDCWD, filename, flags, mode);
        //1，创建struct_file记录open中的各个参数信息，返回一个fd, 将fd和struct_file关联
        查找cdev代码
        fd = get_unused_fd_flags(flags);
        struce file * f = do_filp_open(dfd, tmp, &amp;op, lookup);
        fd_install(fd, f);</p>
<pre><code class="indented-code-block">    //2，查找cdev的代码---在do_filp_open
    chrdev_open查找cdev
    const struct file_operations def_chr_fops = {
        .open = chrdev_open,

            struct cdev *new = NULL;
            //根据设备号找到cdev中的obj
            kobj = kobj_lookup(cdev_map, inode-&gt;i_rdev, &amp;idx);
            通过kobj找到cdev
            new = container_of(kobj, struct cdev, kobj);
            inode-&gt;i_cdev = p = new;    
            //将cdev中fop给了file的f_op
            fops = fops_get(p-&gt;ops);
            //调用了cdev中fop的open方法
            filp-&gt;f_op-&gt;open(inode, filp);

        .llseek = noop_llseek,    
    };
}</code></pre>
<h3 class="atx" id="1-多路复用">1. 多路复用</h3>
<p>对于阻塞的io，如果有多个就会阻塞，无法继续执行，这时就可以用多路复用，进行监听，当有数据的io发生时，就可以立即被处理</p>
<blockquote>
<p>select/poll/epoll监听<br>select 等待数据到来，只要有数据select就返回，无法判断到底哪个io有数据，只能自己去获取数据<br>select主要监控三个集合， readset, writeset, exceptionset，每个set里面有不同fd<br>poll 监控每个fd的读、写、出错状态，监控到状态后，也需要查询到底哪个io状态改变     </p>
</blockquote>
<pre><code class="indented-code-block">int poll(struct pollfd *fds, nfds_t nfds, int timeout);
struct pollfd {
    int fd;    //被监控的fd
    short events; //希望监控的事件
    short revents; //用于查询，当前fd是否发生了读，写，出错
};

while (1)
{
    ret = poll(pfd, 2, 01);
}</code></pre>
<blockquote>
<p>驱动中实现epoll  </p>
</blockquote>
<pre><code class="indented-code-block">__poll_t key_drv_poll (struct file * flp, struct poll_table_struct * pts)
{
    unsigned int mask = 0;

    //1、将当前等待队列头注册到vfs层
    /** 
     * @brief        将当前等待队列头注册到vfs层
     * @param[1]    文件对象
     * @param[2]    等待队列头
     * @param[3]    与等待队列关联的表格
     * @return        
     */
    poll_wait(flp, &amp;key_dev-&gt;wq_head, pts);//这是一个注册动作

    //2、如果有数据返回一个pollin，没有数据返回一个0
    if (key_dev-&gt;have_data)
    {
        mask |= POLLIN;
    }

    return mask;
}

根据图分析驱动中poll的两次调用</code></pre>
<h3 class="atx" id="2-mmap的实现">2. mmap的实现</h3>
<p>1） 是文件io中的一种<br>2）进程空间和驱动数据交互的比较高效的方式<br>3）将内核空间的物理内存映射到用户空间， 可以直接操作地址    </p>
<pre><code class="indented-code-block">#include &lt;sys/mman.h&gt;

/** 
 * @brief        内存映射
 * @param[1]    指定映射到用户空间的地址，一般都填NULL，表示系统自动分配
 * @param[2]    映射的长度
 * @param[3]    对内存的访问权限，PROT_EXEC，PROT_READ，PROT_WRITE
 * @param[4]    是都给其他进程映射，MAP_SHARED，MAP_PRIVATE
 * @param[5]    打开的文件
 * @param[6]    从内存的多少偏移量开始映射 
 * @return        映射到用户空间的地址
 */
void *mmap(void *addr, size_t length, int prot, int flags,
          int fd, off_t offset);
int munmap(void *addr, size_t length);</code></pre>
<blockquote>
<p>驱动的.mmap实现只需要调用如下函数就能将驱动中的物理内存映射到用户空间：<br>vma用于描述用户空间的映射需求，vma是vfs层传递过来    </p>
</blockquote>
<pre><code class="indented-code-block">/** 
 * @brief        内存映射
 * @param[1]    表示需求
 * @param[2]    映射到用户空间的起始位置, addr用kzalloc分配，为虚拟地址，因此需要转为物理地址
                使用virt_to_phys(const volatile void * x)将虚拟地址转为物理地址
 * @param[3]    被映射的物理地址的页地址，用addr/4K，即addr &gt;&gt; 12
 * @param[4]    映射大小，建议为页的倍数
 * @param[5]    映射的权限
 * @return        如果出错建议调用者返回-EAGAIN
 */

addr
int remap_pfn_range(struct vm_area_struct *vma, unsigned long addr,
        unsigned long pfn, unsigned long size, pgprot_t prot)
eg:
    int dt_test_mmap (struct file * flp, struct vm_area_struct * vma)
    {
        unsigned long addr = virt_to_phys(dt_test_dev-&gt;virt_mem);

        vma-&gt;vm_flags |= VM_IO;
        vma-&gt;vm_page_prot = pgprot_noncached(vma-&gt;vm_page_prot);

        if (io_remap_pfn_range(vma, vma-&gt;vm_start,
                         addr &gt;&gt; PAGE_SHIFT,
                         PAGE_SIZE, vma-&gt;vm_page_prot))
        {
            printk(KERN_INFO"io_remap_pfn_range error\n");
            return -EAGAIN;
        }

        return 0;
    }</code></pre>
<h3 class="atx" id="3-中断下半部的实现方式">3. 中断下半部的实现方式</h3>
<blockquote>
<p>中断的上半部、下半部：<br>中断的特性要求中断处理时间不能太长，一般将耗时短的部分放在上半部处理，将耗时长的放在下半部处理<br>Linux中断下半部实现方式：softirq软中断实现,一般在内核开发中使用，tasklet是softirq的一种，workqueue工作队列<br>中断的下半部实际是将处理任务放在一个链表（tasklet）或队列（workqueue），由一个内核线程进行调度执行<br>中断下半部的基本编程：<br>1）初始化tasklet  </p>
</blockquote>
<pre><code class="indented-code-block">/** 
 * @brief        初始化tasklet  
 * @param[1]    tasklet对象 
 * @param[2]    下半部任务处理函数
 * @param[3]    传递给下半部任务处理函数的参数
 * @return        
 */
void tasklet_init(struct tasklet_struct * t, void(* func)(unsigned long), unsigned long data)
struct tasklet_struct
{
    struct tasklet_struct *next;
    unsigned long state;
    atomic_t count;
    void (*func)(unsigned long);
    unsigned long data;
};</code></pre>
<blockquote>
<p>2）在中断的上半部将tasklet加入到内核线程 
    /** 
     * @brief        启动下半部<br>     * @param[1]    tasklet对象 
     * @return<br>     */
    static inline void tasklet_schedule(struct tasklet_struct * t)</p>
</blockquote>
<pre><code class="indented-code-block">/** 
 * @brief        销毁tasklet对象  
 * @param[1]    tasklet对象 
 * @return        
 */
void tasklet_kill(struct tasklet_struct * t)</code></pre>
<blockquote>
<p>2）创建tasklet对象    </p>
</blockquote>
<pre><code class="indented-code-block"> 1. a，tasklet的实现    
2. b, 工作队列的实现    </code></pre>
<h2 class="atx" id="第五天">第五天</h2>
<h3 class="atx" id="主要内容：平台总线">主要内容：平台总线</h3>
<ol>
<li>平台总线的作用</li>
<li>平台总线的编程</li>
<li>平台总线中的自定义数据</li>
<li>内核中的平台设备  </li>
</ol>
<blockquote>
<p>如果要实现一个驱动代码兼容多个设备：<br>分离：将通用/相似的代码和差异化代码分离<br>合并：在实际运行的时候，需要将差异化代码拿出来，进行操作。<br>很多硬件都有相似的操作方法，只是操作地址不同  </p>
</blockquote>
<h3 class="atx" id="1-平台总线的作用">1. 平台总线的作用</h3>
<blockquote>
<p>用于soc的升级/驱动相似的设备</p>
</blockquote>
<pre><code class="indented-code-block">soc:
    s3c2440        s3c6410        s5pv210
    arm9        arm11        A8
    gpio        gpio        gpio
    uart        uart        uart
    i2c            i2c            i2c
    ...

gpio:
    1. 配置gpio的功能
    2. 给数据寄存器赋值

uart：
    1. 设置波特率115200，8n1
    2. 设置no fifo， no AFC
    3. 发送数据---写发送数据寄存器
        接收数据---读取接收数据寄存器
不同soc中：
    操作逻辑/操作方法相似，操作的硬件地址不一样

如果要编写一个gpio驱动，能够在不同的soc中用，怎么办
    在代码编程的时候：
        操作方法的代码（通用代码）-----分离-----硬件的资源（差异化代码）   
            为了更好的代码维护
    在运行的时候：
        操作方法的代码（通用代码）-----合并-----硬件的资源（差异化代码）</code></pre>
<blockquote>
<p>如果需要合并就需要总线：bus、device，driver<br>平台总线的编程<br>平台总线：struct bus_type</p>
</blockquote>
<pre><code class="indented-code-block">struct bus_type {
    const char        *name;
    const char        *dev_name;
    struct device        *dev_root;
    const struct attribute_group **bus_groups;
    const struct attribute_group **dev_groups;
    const struct attribute_group **drv_groups;

    int (*match)(struct device *dev, struct device_driver *drv);
    int (*uevent)(struct device *dev, struct kobj_uevent_env *env);
    int (*probe)(struct device *dev);
    int (*remove)(struct device *dev);
    void (*shutdown)(struct device *dev);

    int (*online)(struct device *dev);
    int (*offline)(struct device *dev);

    int (*suspend)(struct device *dev, pm_message_t state);
    int (*resume)(struct device *dev);

    int (*num_vf)(struct device *dev);

    int (*dma_configure)(struct device *dev);

    const struct dev_pm_ops *pm;

    const struct iommu_ops *iommu_ops;

    struct subsys_private *p;
    struct lock_class_key lock_key;

    bool need_parent_lock;
};</code></pre>
<blockquote>
<p>pdev:   </p>
</blockquote>
<pre><code class="indented-code-block">struct platform_device {    //描述一个设备的信息
    const char    *name;        //名字，用于匹配
    int        id;                //表示不同寄存器的编号
    bool        id_auto;
    struct device    dev;    //父类
    u32        num_resources;    //资源的个数
    struct resource    *resource;    //资源的详细信息，描述中断和内存资源

    const struct platform_device_id    *id_entry;
    char *driver_override; /* Driver name to force a match */

    /* MFD cell pointer */
    struct mfd_cell *mfd_cell;

    /* arch specific additions */
    struct pdev_archdata    archdata;
};

struct resource {//资源
    resource_size_t start;
    resource_size_t end;
    const char *name;
    unsigned long flags;
    unsigned long desc;
    struct resource *parent, *sibling, *child;
};

注册和注销：
    int platform_device_register(struct platform_device*);
    void platform_device_unregister(struct platform_device*);</code></pre>
<blockquote>
<p>pdrv         </p>
</blockquote>
<pre><code class="indented-code-block">struct platform_driver {
    int (*probe)(struct platform_device *);        //表示匹配之后运行的函数
    int (*remove)(struct platform_device *);
    void (*shutdown)(struct platform_device *);
    int (*suspend)(struct platform_device *, pm_message_t state);
    int (*resume)(struct platform_device *);    //父类
    struct device_driver driver;
    const struct platform_device_id *id_table;    //可以匹配列表
    bool prevent_deferred_probe;
};

注册和注销：
    int platform_driver_register(struct platform_driver*);
    void platform_driver_unregister(struct platform_driver*);</code></pre>
<blockquote>
<p>probe中要做事情：<br>1.拿到pdev中的资源，对硬件进行初始化<br>2.为用户提供接口(老套路)</p>
</blockquote>
<pre><code class="indented-code-block">编写驱动的套路：

0、实例化全局的设备对象---kzalloc

1、申请设备号---register_chrdev

2、自动创建节点---class_create, device_create

3、初始化硬件---ioremap

4、实现file_operations</code></pre>
<blockquote>
<p>写完驱动出现编译错误error: array type has incomplete element type ‘struct platform_device_id’
，原因是struct platform_device_id结构体在linux/mod_devicetable.h中定义，没有包含头文件所致<br>卸载plat_led_dev.ko时，出现Device 's5pv210_led' does not have a release() function, it is broken and must be fixed.错误。<br>原因是：platform_device-&gt;device -&gt; release 没有初始化。<br>解决方案：使用platform_device_alloc() , platform_device_add() 替代platform_device_register()去添加设备,如果使用platform_device_register()添加设备需要自己实现 platform_device-&gt;device -&gt; release,3.8以上的内核使用设备树管理设备,除测试外尽量少用这种代码添加的方式.<br>注：Linux3.8之后的内核使用设备树自动生成设备，由内核统一管理，不再手动注册<br>参考： <a href="https://blog.csdn.net/x356982611/article/details/79399371">https://blog.csdn.net/x356982611/article/details/79399371</a>       </p>
</blockquote>
<h3 class="atx" id="3-平台总线中的自定义数据">3. 平台总线中的自定义数据</h3>
<blockquote>
<p>pdev:</p>
</blockquote>
<pre><code class="indented-code-block">resource: 地址和中断号（资源）
定义其他类型的资源和数据

//设计一个自定义数据
struct led_platdata{
    char * name;
    int shift;//移位数据
};

struct led_platdata led_pdata = {
    .name = "gpj0_3/4/5",
    .shift = 3,    
};

struct platform_device led_pdev = {
    .name = "s5pv210_led",
    .id = -1,
    .num_resources = ARRAY_SIZE(led_resource),
    .resource = led_resource,
    .dev = {
        .platform_data = &amp;led_pdata,//&lt;-------------
        .release = plat_led_dev_release,
    }
};</code></pre>
<blockquote>
<p>编程套路：</p>
</blockquote>
<pre><code class="indented-code-block">1. 获取平台自定义数据
2. 获取内存/中断资源
3. ioremap
4. 硬件初始化</code></pre>
<h3 class="atx" id="4-内核中的平台设备">4. 内核中的平台设备</h3>
<blockquote>
<p>什么时候用平台总线</p>
</blockquote>
<pre><code class="indented-code-block">1. 只要有设备的地址和中中断都可以用平台总线
2. 如果写的驱动需要在多个平台中升级使用
3. 平台总线只是一个功能代码：将操作方法和操资源进行分离</code></pre>
<h2 class="atx" id="第六天">第六天</h2>
<h3 class="atx" id="主要内容：输入子系统编程---主要针对输入设备">主要内容：输入子系统编程---主要针对输入设备</h3>
<ol>
<li>输入系统的作用和框架</li>
<li>输入子系统的编程</li>
<li>输入子系统和平台总线的结合</li>
<li>输入子系统的执行流程</li>
</ol>
<h3 class="atx" id="1-输入系统的作用和框架">1. 输入系统的作用和框架</h3>
<blockquote>
<p>针对输入设备：button，keyboard，mouse，ts，gsensor，joystick<br>按照产生数据的类型进行分类：</p>
</blockquote>
<pre><code class="indented-code-block">1. 按键数据----键值
    button，keyboard

2. 绝对坐标数据----有最大值，最小值
    ts，gsensor，陀螺仪

3. 相对坐标数据---下一个坐标是相对于之前的坐标
    mouse， </code></pre>
<blockquote>
<p>引入输入子系统对输入设备进行驱动管理    </p>
</blockquote>
<pre><code class="indented-code-block">1. 为驱动定义一个标准的编程方式
2. 用户空间到数据格式是统一的</code></pre>
<blockquote>
<p>输入子系统框架    </p>
</blockquote>
<pre><code class="indented-code-block">应用层

input handler层数据处理层：kernel/drivers/inpout/evdev.c    
    1. 和用户进行交互，实现fops
    2. 不知道数据是如何得到，但是知道如何将数据交给用户

input core层：kernel/drivers/inpout/input.c
    1. 维护了两个链表
    2. 为上下两层提供接口

input device层：输入设备硬件层
    内核自带的input device代码：
        drivers/input/touchscreen等
    1. 初始化硬件，获取硬件中的数据
    2. 知道得到数据，但是不知道如何将数据交给用户

确保zImage已经包含了input core和input handler层代码
    make menuconfig
     Device Drivers  ---&gt; 
        Input device support  ---&gt;
            -*- Generic input layer (needed for keyboard, mouse, ...) //input.c
                &lt;*&gt;   Event interface //evdev.c  input handler层的代码</code></pre>
<blockquote>
<p>输入子系统的编程 ：Documentation/input/input-programming.rst   </p>
</blockquote>
<pre><code class="indented-code-block">a. 分配一个input device对象   
    struct input_dev *input_allocate_device(void)
    input_free_device(button_dev);

b. 初始化input devide对象
    struct input_dev {
        const char *name;
        const char *phys;
        const char *uniq;
        struct input_id id;

        unsigned long propbit[BITS_TO_LONGS(INPUT_PROP_CNT)];
        //位表----每个bit表示不同的意义
        //BITS_TO_LONGS就是计算用多少个long来表示多长的bit
        //BITS_TO_LONGS = num / 32
        //evbit表示能够长生哪些数据类型
        unsigned long evbit[BITS_TO_LONGS(EV_CNT)];
        //keybit表示能够产生哪些按键数据
        unsigned long keybit[BITS_TO_LONGS(KEY_CNT)];//keybit[BITS_TO_LONGS(768)] = keybit[24]
        //relbit表示能够产生哪些相对坐标
        unsigned long relbit[BITS_TO_LONGS(REL_CNT)];
        //absbit表示能够产生哪些绝对坐标
        unsigned long absbit[BITS_TO_LONGS(ABS_CNT)];
        unsigned long mscbit[BITS_TO_LONGS(MSC_CNT)];
        unsigned long ledbit[BITS_TO_LONGS(LED_CNT)];
        unsigned long sndbit[BITS_TO_LONGS(SND_CNT)];
        unsigned long ffbit[BITS_TO_LONGS(FF_CNT)];
        unsigned long swbit[BITS_TO_LONGS(SW_CNT)];

        struct device dev;//父类
        struct list_head h_list;
        struct list_head node;//链表节点
        ...
    }；

    struct input_event { //用户读取到的输入设备的数据包
    #if (__BITS_PER_LONG != 32 || !defined(__USE_TIME_BITS64)) &amp;&amp; !defined(__KERNEL__)
        struct timeval time; //时间戳
    #define input_event_sec time.tv_sec
    #define input_event_usec time.tv_usec
    #else
        __kernel_ulong_t __sec;
    #if defined(__sparc__) &amp;&amp; defined(__arch64__)
        unsigned int __usec;
        unsigned int __pad;
    #else
        __kernel_ulong_t __usec;
    #endif
    #define input_event_sec  __sec
    #define input_event_usec __usec
    #endif
        __u16 type;    //读取到数据类型：EV_KEY, EV_ABS, EB_REL
        __u16 code;    //码值
        __s32 value;//状态
    };

c. 注册input device对象
d. 硬件初始化</code></pre>
<blockquote>
<p>看源码：    </p>
<ol>
<li>看整个分层    </li>
<li>看应用和驱动如何交互    </li>
</ol>
</blockquote>
<pre><code class="indented-code-block">open，read()</code></pre>
<blockquote>
<ol>
<li>分层    </li>
</ol>
</blockquote>
<pre><code class="indented-code-block">input handler
    evdev.c
    module_init(evdev_init);
    module_exit(evdev_exit);
    static struct input_handler evdev_handler = {
        .event        = evdev_event,
        .events        = evdev_events,
        .connect    = evdev_connect,
        .disconnect    = evdev_disconnect,
        .legacy_minors    = true,
        .minor        = EVDEV_MINOR_BASE,
        .name        = "evdev",
        .id_table    = evdev_ids,//用于比较的
    };

    input_register_handler(&amp;evdev_handler);

        INIT_LIST_HEAD(&amp;handler-&gt;h_list);
        注册到input core层
        //将当前的evdev_handler放入到input_table
        list_add_tail(&amp;handler-&gt;node, &amp;input_handler_list);

        list_for_each_entry(dev, &amp;input_dev_list, node)
                input_attach_handler(dev, handler);
                    id = input_match_device(handler, dev);
                    error = handler-&gt;connect(handler, dev, id);//一旦匹配成功，调用connect


input core
    input.c为一个单独驱动
    err = class_register(&amp;input_class);
    err = input_proc_init();
    err = register_chrdev_region(MKDEV(INPUT_MAJOR, 0),
                 INPUT_MAX_CHAR_DEVICES, "input");
    subsys_initcall(input_init);
    module_exit(input_exit);


input device
    input_register_device();

        INIT_LIST_HEAD(&amp;handler-&gt;h_list);
        list_add_tail(&amp;handler-&gt;node, &amp;input_handler_list);
        list_for_each_entry(dev, &amp;input_dev_list, node)
        input_attach_handler(dev, handler);//匹配
            id = input_match_device(handler, dev);
            error = handler-&gt;connect(handler, dev, id);//一旦匹配成功，调用connect, input_attach_handler

    调用的conncet方法：
        .connect    = evdev_connect //evdev.c
        int evdev_connect(struct input_handler *handler, struct input_dev *dev,
         const struct input_device_id *id)
        //获取一个新的此设备号，在64~64+32之间
        minor = input_get_new_minor(EVDEV_MINOR_BASE, EVDEV_MINORS, true);
        if (minor &lt; 0) {
            error = minor;
            pr_err("failed to reserve new minor: %d\n", error);
            return error;
        }

        //分配一个evdev对象
        evdev = kzalloc(sizeof(struct evdev), GFP_KERNEL);
        if (!evdev) {
            error = -ENOMEM;
            goto err_free_minor;
        }
        //初始化evdev对象
        INIT_LIST_HEAD(&amp;evdev-&gt;client_list);
        spin_lock_init(&amp;evdev-&gt;client_lock);
        mutex_init(&amp;evdev-&gt;mutex);
        //初始化队列头，用于阻塞
        init_waitqueue_head(&amp;evdev-&gt;wait);
        evdev-&gt;exist = true;

        dev_no = minor;
        /* Normalize device number if it falls into legacy range */
        if (dev_no &lt; EVDEV_MINOR_BASE + EVDEV_MINORS)
            dev_no -= EVDEV_MINOR_BASE;

        //利用handle记录了inputdev和input handler
        evdev-&gt;handle.dev = input_get_device(dev);
        evdev-&gt;handle.name = dev_name(&amp;evdev-&gt;dev);
        evdev-&gt;handle.handler = handler;
        //相互留个联系方式
        evdev-&gt;handle.private = evdev;

        //创建设备节点；以下代码等同于 device_create
        //设置设备名，event0，event1...
        dev_set_name(&amp;evdev-&gt;dev, "event%d", dev_no);
        evdev-&gt;dev.devt = MKDEV(INPUT_MAJOR, minor);
        evdev-&gt;dev.class = &amp;input_class;
        evdev-&gt;dev.parent = &amp;dev-&gt;dev;
        evdev-&gt;dev.release = evdev_free;
        device_initialize(&amp;evdev-&gt;dev);
        //inputdev, input handler，input handle建立双向关系
        input_register_handle(&amp;evdev-&gt;handle);

            struct input_handler *handler = handle-&gt;handler;
            struct input_dev *dev = handle-&gt;dev;
            list_add_tail_rcu(&amp;handle-&gt;d_node, &amp;dev-&gt;h_list);
            list_add_tail_rcu(&amp;handle-&gt;h_node, &amp;handler-&gt;h_list);

        //将当前的evdev放入到evdev_table[minor]
        cdev_init(&amp;evdev-&gt;cdev, &amp;evdev_fops);
        error = cdev_device_add(&amp;evdev-&gt;cdev, &amp;evdev-&gt;dev);</code></pre>
<blockquote>
<ol start="2">
<li>看应用和驱动如何交互    </li>
</ol>
</blockquote>
<pre><code class="indented-code-block">open("/dev/input/event0", O_RDWR);
read(fd, &amp;event, sizeof(struct input_event));

VFS:
    sys_open
        根据设备号找到cdev
驱动层的open
    input.c
    static const struct file_operations input_devices_fileops = {
        .owner        = THIS_MODULE,
        .open        = input_proc_devices_open,
        .poll        = input_proc_devices_poll,
        .read        = seq_read,
        .llseek        = seq_lseek,
        .release    = seq_release,
    };

struct input_event event;
read(fd, &amp;event, sizeof(struct input_event));

sys_read

    filp-&gt;f_fop-&gt;read()
evdev.c
    .read = evdev_read,

        //阻塞
        while (read + input_event_size() &lt;= count &amp;&amp;
               evdev_fetch_next_event(client, &amp;event)) {
            //拷贝给用户
            if (input_event_to_user(buffer + read, &amp;event))
                return -EFAULT;

            read += input_event_size();
        }

        if (read)
            break;

        //如果阻塞被唤醒，会从evdev_client中获取event
        if (!(file-&gt;f_flags &amp; O_NONBLOCK)) {
            error = wait_event_interruptible(evdev-&gt;wait,
                    client-&gt;packet_head != client-&gt;tail ||
                    !evdev-&gt;exist || client-&gt;revoked);
            if (error)
                return error;
        }

        //谁唤醒
        input_event(button_dev, EV_KEY, pdesc-&gt;code, 1);
        input_sync(button_dev);
        input_handle_event(dev, type, code, value);//跳转到evdev.c</code></pre>
<h2 class="atx" id="第七天">第七天</h2>
<h3 class="atx" id="主要内容-1">主要内容</h3>
<ol>
<li>i2c协议讲解</li>
<li>i2c子系统框架</li>
<li>i2c子系统驱动编程--从设备at24c02</li>
<li>i2c子系统框架代码流程</li>
</ol>
<blockquote>
<p>i2c驱动
i2c设备比较多：ts，camera，e2prom，gsensor，hdmi</p>
</blockquote>
<h3 class="atx" id="1-i2c协议讲解">1. i2c协议讲解</h3>
<blockquote>
<p>1） 传输协议：master首先通过总线发送一个起始位S，然后通过总线发送一个从设备地址（7bit/10bit，一般为7bit）+ 1bit R/W位，总线上的从设备比对自己的地址，如果与主机发送的地址相等，则给主机回1bit的ACK，主机收到ACK后，开始进行数据传输（8bit数据+1bit ACK）   </p>
</blockquote>
<blockquote>
<p>2） 时序：SCK时钟线有一个固定的时钟频率，在空闲时SDA线为高电平，当要开始发数据时，主机在时钟为高电平期间将SDA拉低（S位产生），第二个周期开始的7周期（或10个周期）位从机地址，第8个周期传输读写位（R/W位如果为高则为读，为低则为写），第9个周期master强行将SDA拉高，如果从设备响应则会在SCK为高电平时把SDA强行拉低，master则认为收到响应ACK，接下来的周期为8bit数据+1bit ACK，进行数据传输。当在SCK位高电平的半周期，SDA由低变高则表示停止。</p>
</blockquote>
<blockquote>
<ol start="3">
<li>实际中在对i2c设备进行读写时，如果进行写，则主机首先发送Sbit+7bit地址+Wbit+ACK,然后从设备(如eeprom)的内部地址若干bits+ACK+ 若干数据8bits+ACK + Pbit , 如果读，则需要，首先发送Sbit+7bit地址+Wbit+ACK, 再发送从设备(如eeprom)的内部地址若干bits+ACK+P， 然后重新发送起始位进行转换模式Sbit+7bit地址+Rbit+ACK  + 若干数据8bits+ACK + Pbit。</li>
</ol>
</blockquote>
<blockquote>
<p>注意：当在进行数据传输时，SDA上的数据只有在SCK为高电平的半周期才有效，因此数据在传输过程中，只有SCK为低电平的半周期中，SDA上的数据才可以变化，而起始和停止位（S/P）只有在SCK为高电平时SDA变化才认为是起始和停止位，（在SCK位高电平的半周期，如果SDA由高变低则产生S位，如果由低变高则产生P位）</p>
</blockquote>
<h3 class="atx" id="2-i2c子系统框架">2. i2c子系统框架</h3>
<blockquote>
<p>应用层</p>
</blockquote>
<blockquote>
<p>驱动层</p>
</blockquote>
<pre><code class="indented-code-block">i2c driver层 （从设备驱动层，与用户交互）probe，remove，注册到driver链表
    1 负责与用户交互
    2 知道要传输给从设备的数据是什么，但不知道如何通过硬件操作给从设备

i2c core层 以名字匹配dev和drv，并执行probe
    维护了i2c总线
    drivers/i2c/i2c-core-base.c i2c-core-of.c
    drivers/i2c/busses/i2c-s3c2410.c

i2c-adapter适配器层（i2c控制器层）：
    与硬件交互，负责硬件的初始化，即初始化i2c控制器
    知道如何将数据给从设备，但是不知道数据是什么
    创建i2c_client(slaver name and address),注册到device链表

如何确保低两层内核自带，make menuconfig
    &gt; Device Drivers
        &gt; I2C support   //i2c-corc.c
            &gt; I2C Hardware Bus support
                &gt; S3C2410 I2C Driver //i2c-s3c2410.c

如何查看？ // /sys/bus/i2c</code></pre>
<h3 class="atx" id="3-i2c子系统驱动编程--从设备at24c02">3. i2c子系统驱动编程--从设备at24c02</h3>
<blockquote>
<p>间接为i2c_client提供信息，有了信息后，系统会自动创建i2c_client<br>构建i2c_driver，注册到总线中</p>
</blockquote>
<pre><code class="indented-code-block">1. 构建i2c_driver，注册到总线
    i2c_add_driver(struct i2c_driver *);
    i2c_del_drive(struct i2c_driver *);

    struct i2c_driver {
        unsigned int class;

        /* Standard driver model interfaces */
        int (*probe)(struct i2c_client *, const struct i2c_device_id *);
        int (*remove)(struct i2c_client *);
        ...
        struct device_driver driver;
        const struct i2c_device_id *id_table;
        ...

    };

2. i2c系统中为从设备传输数据的方法
    i2c_master_send(const struct i2c_client * client, const char * buf, int count)
    i2c_master_recv(const struct i2c_client * client, char * buf, int count)

    都调用了i2c_transfer(struct i2c_adapter * adap, struct i2c_msg * msgs, int num)

    类似struct platform
    struct i2c_client {//描述一个从设备信息的对象，里面所有的成员都是自动初始化
        unsigned short flags;        /* div., see below        */
        unsigned short addr;//从设备地址        /* chip address - NOTE: 7bit    */
                        /* addresses are stored in the    */
                        /* _LOWER_ 7 bits        */
        char name[I2C_NAME_SIZE];//名字用于和driver匹配
        struct i2c_adapter *adapter;//指向创建自己的adapter    /* the adapter we sit on    */
        struct device dev;        /* the device structure        */
        int init_irq;            /* irq set at initialization    */
        int irq;            /* irq issued by device        */
        struct list_head detected;
    #if IS_ENABLED(CONFIG_I2C_SLAVE)
        i2c_slave_cb_t slave_cb;    /* callback for slave mode    */
    #endif
    };

    struct i2c_adapter {
        struct module *owner;
        unsigned int class;          /* classes to allow probing for */
        const struct i2c_algorithm *algo; /* the algorithm to access the bus */
        void *algo_data;

        /* data fields that are valid for all devices    */
        const struct i2c_lock_operations *lock_ops;
        struct rt_mutex bus_lock;
        struct rt_mutex mux_lock;

        int timeout;            /* in jiffies */
        int retries;
        struct device dev;    //父类    /* the adapter device */

        int nr;
        char name[48];
        struct completion dev_released;

        struct mutex userspace_clients_lock;
        struct list_head userspace_clients;

        struct i2c_bus_recovery_info *bus_recovery_info;
        const struct i2c_adapter_quirks *quirks;

        struct irq_domain *host_notify_domain;
    };

    struct i2c_algorithm {
        /* If an adapter algorithm can't do I2C-level access, set master_xfer
           to NULL. If an adapter algorithm can do SMBus access, set
           smbus_xfer. If set to NULL, the SMBus protocol is simulated
           using common I2C messages */
        /* master_xfer should return the number of messages successfully
           processed, or a negative value on error */
        int (*master_xfer)(struct i2c_adapter *adap, struct i2c_msg *msgs,
                   int num);//操作硬件的方法
        int (*smbus_xfer) (struct i2c_adapter *adap, u16 addr,
                   unsigned short flags, char read_write,
                   u8 command, int size, union i2c_smbus_data *data);

        /* To determine what the adapter supports */
        u32 (*functionality) (struct i2c_adapter *);

    #if IS_ENABLED(CONFIG_I2C_SLAVE)
        int (*reg_slave)(struct i2c_client *client);
        int (*unreg_slave)(struct i2c_client *client);
    #endif
    };


    struct i2c_msg {//传送给从设备的数据包
        __u16 addr;    //从设备的地址 /* slave address            */
        __u16 flags;//表示读还是写
        __u16 len;    //表示数据的字节数    /* msg length                */
        __u8 *buf;    //数据的缓冲指针    /* pointer to msg data            */
    };</code></pre>
<h2 class="atx" id="第八天-如何跟读内核代码">第八天 如何跟读内核代码</h2>
<ol>
<li><p>任务：总线匹配之后，调用drv中的probe(), 跟读probe所有代码</p>
</li>
<li><p>如何跟读内核代码技巧：</p>
<ol>
<li>看主线--主要的技术点</li>
<li>出错判断和变量不看</li>
<li>看不懂的不看</li>
<li>大胆去猜函数的作用</li>
<li>百度搜索函数</li>
<li>做好笔记和注释，以及总结</li>
<li>总结当前代码段/函数做了什么</li>
</ol>
</li>
<li><p>i2c子系统的框架代码</p>
<p> at24_drv.c:----4</p>
<p> i2c-core-base.c:----2</p>
<pre><code class="indented-code-block"> 如果要构建一个新的总线只需要注册一个， 就会在/sys/bus/下产生新的总线
 bus_register(struct bus_type* type)
 //往一个总线中增加一个设备dev, dev中的bus成员可以决定自己属于哪个总线
 device_register(struct devide * dev)
 //往一个总线中增加一个驱动drv, drv中的bus成员可以决定自己属于哪个总线
 driver_register(struct driver * drv)

 i2c_new_device是谁调用的？

 struct i2c_client *
 i2c_new_device(struct i2c_adapter *adap, struct i2c_board_info const *info)
     client = kzalloc(sizeof *client, GFP_KERNEL);
     client-&gt;adapter = adap;
     client-&gt;dev.platform_data = info-&gt;platform_data;
     client-&gt;flags = info-&gt;flags;
     client-&gt;addr = info-&gt;addr;
     client-&gt;init_irq = info-&gt;irq;
     status = i2c_check_addr_validity(client-&gt;addr, client-&gt;flags);
     status = i2c_check_addr_busy(adap, i2c_encode_flags_to_addr(client));

     client-&gt;dev.parent = &amp;client-&gt;adapter-&gt;dev;
     client-&gt;dev.bus = &amp;i2c_bus_type;
     client-&gt;dev.type = &amp;i2c_client_type;
     client-&gt;dev.of_node = of_node_get(info-&gt;of_node);
     client-&gt;dev.fwnode = info-&gt;fwnode;

     status = device_register(&amp;client-&gt;dev);
 总结：
     i2c_new_device函数中：
         1. 构建了i2c_client
         2. 初始化i2c_client, 通过i2c_board_info来初始化
         3. 注册到i2c总线

 i2c_add_adapter//将adapter注册i2c总线, 是谁调用该函数？应该从init里面看，由i2c-s3c2410.c probe调用
     i2c_register_adapter
         device_register(&amp;adap-&gt;dev);
         i2c_scan_static_board_info
         bus_for_each_drv(&amp;i2c_bus_type, NULL, adap, __process_new_adapter);
 总结：
     adapter再注册的时候，会遍历__i2c_board_list链表
     如果adapter的编号和链表节点中的号码一致，就会构建一个i2c_client并注册client
     i2c_client中的成员的值来自board_info</code></pre>
<p> i2c-s3c2410.c----3//平台总线的套路，既是driver也是一个adapter</p>
<pre><code class="indented-code-block"> platform_driver_register(&amp;s3c24xx_i2c_driver);
     s3c24xx_i2c_probe
         //获取平台自定义数据
         pdata = dev_get_platdata(&amp;pdev-&gt;dev);
         //分配一个全局的设备对象---分配i2c_adapter
         i2c = devm_kzalloc(&amp;pdev-&gt;dev, sizeof(struct s3c24xx_i2c), GFP_KERNEL);
         //初始化adapter
         strlcpy(i2c-&gt;adap.name, "s3c2410-i2c", sizeof(i2c-&gt;adap.name));
         i2c-&gt;adap.owner = THIS_MODULE;
         i2c-&gt;adap.algo = &amp;s3c24xx_i2c_algorithm;
         i2c-&gt;adap.retries = 2;
         i2c-&gt;adap.class = I2C_CLASS_DEPRECATED;
         i2c-&gt;tx_setup = 50;</code></pre>
<p> mach-smdkv210.c/设备树----1</p>
</li>
</ol>
<h3 class="atx" id="总结：">总结：</h3>
<blockquote>
<p>所有的总线注册到内核链表的都是struct device和struct driver对象，这样便于链表的管理</p>
</blockquote>
<h3 class="atx" id="lcd屏-framebuffer">LCD屏 FrameBuffer</h3>
<h3 class="atx" id="主要内容--framebuffer子系统--lcd屏驱动">主要内容--framebuffer子系统--lcd屏驱动</h3>
<ol>
<li>FrameBuffer子系统的框架</li>
<li>LCD屏的驱动移植</li>
<li>启动LOGO的制作</li>
<li>应用程序控制LDC屏的方法</li>
<li>FrameBuffer子系统代码执行流程     </li>
</ol>
<blockquote>
<p>补充知识点：设定自定义平台数据的方式   </p>
<ol>
<li>在初始化的时候给定一个    </li>
<li>通过接口随时修改平台自定义数据, s3c_fb_set_platdata    </li>
<li>有设备树时候，自动从设备树获取    </li>
</ol>
</blockquote>
<h3 class="atx" id="1-framebuffer子系统的框架">1. FrameBuffer子系统的框架</h3>
<p>应用层：</p>
<p>fb通用层：知道映射，但是不知道如何分配显存</p>
<pre><code class="indented-code-block">1. 负责和应用层交互
2. 实现显存的映射</code></pre>
<p>xxx-LCD控制器层：知道分配显存，但是不知道如何映射</p>
<pre><code class="indented-code-block">1. 初始化LCD控制器
2. 实现显存的分配</code></pre>
<h3 class="atx" id="2-lcd屏的驱动移植">2. LCD屏的驱动移植</h3>
<blockquote>
<p>Documentation/fb/framebuffer.txt    </p>
</blockquote>
<blockquote>
<pre><code class="indented-code-block">     soc               lcd屏                        驱动    </code></pre>
<p>垂直方向</p>
</blockquote>
<blockquote>
<pre><code class="indented-code-block">     VSPW(无效周期)     tvpw(1&lt;y&lt;20)      y=10      vsync_len
     VBPD(稳定周期)     tvb-tvpw   (23-tvpw)13      upper_margin
     LINVAL(行数)       tvd                480      xres
     VFPD(返回时间)     tvfp               22       lower_margin</code></pre>
</blockquote>
<blockquote>
<p>水平方向</p>
</blockquote>
<blockquote>
<pre><code class="indented-code-block">     HSPW(无效周期)     thpw(1&lt;x&lt;40)      x=20      hsync_len
     HBPD(稳定周期)     thb-thpw   (46-thpw)26      left_margin
     HOZVAL(行数)       thd                800      xres
     HFPD(返回时间)     thfp               210      right_margin</code></pre>
</blockquote>
<blockquote>
<p>移植的时候主要是配置设备树<br>如何确保fb通用层和lcd控制器层的驱动已经存在    </p>
</blockquote>
<pre><code class="indented-code-block">&gt; Device Drivers &gt; 
    Graphics support &gt; 
        Frame buffer Devices &gt; 
            Support for frame buffer devices&gt; //fbmem.c
                Samsung S3C framebuffer support  //s3c-fb.c

Device Drivers &gt; Graphics support &gt; Console display driver support //将图片加载到显存中去显示

&gt; Device Drivers &gt; Graphics support &gt; Bootup logo
    [*]   Standard black and white Linux logo
    [*]   Standard 16-color Linux logo 
    [*]   Standard 224-color Linux logo //表示的是一张图片linux-4.19.100\drivers\video\logo\logo_superh_clut224.ppm</code></pre>
<ol start="4">
<li><p>应用程序控制LCD屏的方法</p>
<ol>
<li>打开设备</li>
</ol>
<pre><code class="fenced-code-block language-c"><span class="token keyword">int</span> fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"dev/fb0"</span><span class="token punctuation">,</span> O_RDWR<span class="token punctuation">)</span><span class="token punctuation">;</span>   </code></pre>
<ol start="2">
<li>获取到LCD屏的信息xres, yres, bpp</li>
</ol>
<pre><code class="fenced-code-block language-c"><span class="token keyword">struct</span> <span class="token class-name">fb_var_screeninfo</span> var<span class="token punctuation">;</span>
<span class="token function">ioctl</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> FBIOGET_VSCREENINFO<span class="token punctuation">,</span> <span class="token operator">&amp;</span>var<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span>unlocked_ioctl <span class="token operator">=</span> fb_ioctl<span class="token punctuation">,</span>
        <span class="token keyword">struct</span> <span class="token class-name">fb_info</span> <span class="token operator">*</span>info <span class="token operator">=</span> <span class="token function">file_fb_info</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">struct</span> <span class="token class-name">fb_info</span> <span class="token operator">*</span>info <span class="token operator">=</span> registered_fb<span class="token punctuation">[</span>fbidx<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//从registered_fb数组中得到fb_info</span>
        <span class="token function">do_fb_ioctl</span><span class="token punctuation">(</span>info<span class="token punctuation">,</span> cmd<span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">case</span> FBIOGET_VSCREENINFO<span class="token operator">:</span>        
                var <span class="token operator">=</span> info<span class="token operator">-&gt;</span>var<span class="token punctuation">;</span>
                ret <span class="token operator">=</span> <span class="token function">copy_to_user</span><span class="token punctuation">(</span>argp<span class="token punctuation">,</span> <span class="token operator">&amp;</span>var<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>var<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token operator">-</span>EFAULT <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span></code></pre>
<ol start="3">
<li>映射显存到用户空间</li>
</ol>
<pre><code class="fenced-code-block language-c"><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">mmap</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token class-name">size_t</span> length<span class="token punctuation">,</span> PROT_READ<span class="token operator">|</span>PROT_WRITE<span class="token punctuation">,</span> MAP_SHARED<span class="token punctuation">,</span>
                  <span class="token keyword">int</span> fd<span class="token punctuation">,</span> <span class="token class-name">off_t</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//length 一般为一帧的长度</span>
<span class="token class-name">size_t</span> length <span class="token operator">=</span> var<span class="token punctuation">.</span>xres<span class="token operator">*</span>var<span class="token punctuation">.</span>yres <span class="token operator">*</span> var<span class="token punctuation">.</span>bits_per_pixel <span class="token operator">/</span> <span class="token number">8</span><span class="token punctuation">;</span></code></pre>
<ol start="4">
<li>得到图片数据</li>
</ol>
</li>
<li><p>高级子系统驱动套路</p>
</li>
</ol>
<p>分配一个对象，初始化这个对象，注册这个对象(input子系统，i2c子系统，网卡驱动，块设备驱动)</p>
<h2 class="atx" id="第九天-触摸屏">第九天 触摸屏</h2>
<h3 class="atx" id="主要内容----电容触摸屏驱动">主要内容----电容触摸屏驱动</h3>
<ol>
<li><p>触摸屏的基本工作原理</p>
</li>
<li><p>电容触摸屏驱动框架</p>
</li>
<li><p>电容触摸屏读取坐标的原理和硬件初始化</p>
</li>
<li><p>Linux下多点触摸的协议</p>
</li>
<li><p>电容触摸屏的驱动编写--gt811</p>
</li>
</ol>
<h3 class="atx" id="驱动编程：">驱动编程：</h3>
<ol>
<li>提供i2c client信息</li>
</ol>
<p>arch\arm\mach-s5pv210\mach-smdkv210.c</p>
<pre><code class="fenced-code-block language-c"><span class="token keyword">static</span> <span class="token keyword">struct</span> <span class="token class-name">i2c_board_info</span> smdkv210_i2c_devs2<span class="token punctuation">[</span><span class="token punctuation">]</span> __initdata <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">/* To Be Updated */</span>
    <span class="token punctuation">{</span> <span class="token function">I2C_BOARD_INFO</span><span class="token punctuation">(</span><span class="token string">"gt811_ts"</span><span class="token punctuation">,</span> <span class="token number">0x5d</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>make zImage -j4</p>
<p>更新内核</p>
<pre><code class="fenced-code-block language-shell"><span class="token punctuation">[</span>root@<span class="token variable">$x210</span><span class="token builtin class-name">:</span> /<span class="token punctuation">]</span><span class="token comment"># cd /sys/bus/i2c/</span>
<span class="token punctuation">[</span>root@<span class="token variable">$x210</span><span class="token builtin class-name">:</span> i2c<span class="token punctuation">]</span><span class="token comment"># ls</span>
devices            drivers_autoprobe  uevent
drivers            drivers_probe
<span class="token punctuation">[</span>root@<span class="token variable">$x210</span><span class="token builtin class-name">:</span> i2c<span class="token punctuation">]</span><span class="token comment"># cd devices/</span>
<span class="token punctuation">[</span>root@<span class="token variable">$x210</span><span class="token builtin class-name">:</span> devices<span class="token punctuation">]</span><span class="token comment"># ls</span>
<span class="token number">0</span>-001b  <span class="token number">0</span>-0050  <span class="token number">2</span>-005d  i2c-0   i2c-1   i2c-2
<span class="token punctuation">[</span>root@<span class="token variable">$x210</span><span class="token builtin class-name">:</span> devices<span class="token punctuation">]</span><span class="token comment"># cd 2-005d/</span>
<span class="token punctuation">[</span>root@<span class="token variable">$x210</span><span class="token builtin class-name">:</span> <span class="token number">2</span>-005d<span class="token punctuation">]</span><span class="token comment"># cat </span>
modalias    name        power/      subsystem/  uevent
<span class="token punctuation">[</span>root@<span class="token variable">$x210</span><span class="token builtin class-name">:</span> <span class="token number">2</span>-005d<span class="token punctuation">]</span><span class="token comment"># cat name </span>
gt811_ts</code></pre>
<ol start="2">
<li>编写从设备驱动</li>
</ol>
<p>EINT14---GPH1_6</p>
<p>RESET---GPD0_3</p>
<p>硬件初始化：</p>
<p>a. 设置INT引脚为输入态，RESET设置成高电平（内部上拉）</p>
<p>b. RESET输出为低，延时1ms，转成输入态</p>
<p>c. 延时至少20ms，通过i2c寻址判断是否有响应</p>
<p>d. 如果有响应就分一次或多次初始化配置106个寄存器</p>
<h3 class="atx" id="linux下多点触摸的协议">Linux下多点触摸的协议</h3>
<p>两点：</p>
<pre><code class="fenced-code-block language-c">   ABS_MT_POSITION_X x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
   ABS_MT_POSITION_Y y<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
   SYN_MT_REPORT<span class="token comment">//表示第一个点上报完毕</span>
   ABS_MT_POSITION_X x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
   ABS_MT_POSITION_Y y<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
   SYN_MT_REPORT<span class="token comment">//表示第二个点上报完毕</span>
   SYN_REPORT<span class="token comment">//所有点都上报完毕</span>

   如果用代码去实现：
   <span class="token function">input_event</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> EV_ABS<span class="token punctuation">,</span> ABS_MT_POSITION_X <span class="token punctuation">,</span> <span class="token number">333</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">input_event</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> EV_ABS<span class="token punctuation">,</span> ABS_MT_POSITION_Y <span class="token punctuation">,</span> <span class="token number">133</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">input_mt_sync</span><span class="token punctuation">(</span>dev<span class="token punctuation">)</span>
       <span class="token function">input_event</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> EV_SYN<span class="token punctuation">,</span> SYN_MT_REPORT<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token function">input_event</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> EV_ABS<span class="token punctuation">,</span> ABS_MT_POSITION_X <span class="token punctuation">,</span> <span class="token number">433</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">input_event</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> EV_ABS<span class="token punctuation">,</span> ABS_MT_POSITION_Y <span class="token punctuation">,</span> <span class="token number">533</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">input_mt_sync</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">input_dev</span> <span class="token operator">*</span> dev<span class="token punctuation">)</span>

   <span class="token function">input_sync</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">input_dev</span> <span class="token operator">*</span> dev<span class="token punctuation">)</span></code></pre>
<h2 class="atx" id="第十天">第十天</h2>
<h3 class="atx" id="主要内容---内核工作原理解析">主要内容---内核工作原理解析</h3>
<ol>
<li><p>内核的编译步骤</p>
</li>
<li><p>Kconfig和Makefile的使用</p>
</li>
<li><p>内核的裁剪---make menuconfig</p>
</li>
<li><p>内核的工作原理</p>
<p>a. 内核的内部构造</p>
<p>b. 内核的启动步骤</p>
<p>c. 内核中module_init是什么</p>
<p>d. 挂载是什么意思</p>
<p>e. 祖先进程init是如何启动的</p>
</li>
</ol>
<h3 class="atx" id="1-内核的编译步骤">1. 内核的编译步骤</h3>
<blockquote>
<p>step1:设置交叉编译工具链</p>
<pre><code class="fenced-code-block language-shell"><span class="token assign-left variable">ARCH</span><span class="token operator">=</span>arm
<span class="token assign-left variable">CROSS_COMPILE</span><span class="token operator">=</span>arm-none-linux-gnueabi-</code></pre>
<p>step2:选择当前的soc---s5pv210</p>
<pre><code class="fenced-code-block language-shell"><span class="token function">make</span> s5pv210_defconfig</code></pre>
<p>step3:make menuconfig---内核剪裁</p>
<pre><code class="fenced-code-block language-shell">System Type  ---<span class="token operator">&gt;</span> 
    <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> S3C UART to use <span class="token keyword">for</span> low-level messages</code></pre>
<p>step4:make zImage或make uImage</p>
<pre><code class="fenced-code-block language-shell"><span class="token function">make</span> uImage</code></pre>
</blockquote>
<h3 class="atx" id="2-kconfig和makefile的使用">2. Kconfig和Makefile的使用</h3>
<h3 class="atx" id="3-内核的裁剪---make-menuconfig">3. 内核的裁剪---make menuconfig</h3>
<p><img alt="" src="file:///F:/02-src/driver_study/mydrv/images/2022-09-28-23-38-42-image.png"></p>
<p>文件系统类型图</p>
<p><img alt="" src="file:///F:/02-src/driver_study/mydrv/images/2022-09-30-20-44-05-image.png"></p>
<p>设备驱动选择方式图</p>
<p><img alt="" src="file:///F:/02-src/driver_study/mydrv/images/2022-09-29-21-29-29-image.png"></p>
<h3 class="atx" id="4-内核的工作原理">4. 内核的工作原理</h3>
<blockquote>
<p>uImage = 64字节头 + zImage</p>
</blockquote>
<blockquote>
<p>uImage表示u-boot启动的内核---Linux，bsd，VxWorks，但是启动方式不一样</p>
<p>Linux：arm，x86，mips等架构的内核</p>
<p>为何u-boot可以启动zImage：因为u-boot做了移植，默认认为zImage就是架构的Linux内核</p>
<p>64字节头包含了描述内核的信息，u-boot在启动内核时会根据64字节的信息启动不同系统不同架构的内核</p>
<p>mkimage工具：增加64字节的头信息，mkimage是由u-boot提供的。</p>
</blockquote>
<blockquote>
<p>可以手动使用mkimage对zImage进行添加64字节的头</p>
<pre><code class="fenced-code-block language-shell">dwu@atc-dwu:~$ mkimage 
Error: Missing output filename
Usage: mkimage -l image
          -l <span class="token operator">==</span><span class="token operator">&gt;</span> list image header information
       mkimage <span class="token punctuation">[</span>-x<span class="token punctuation">]</span> -A arch -O os -T <span class="token builtin class-name">type</span> -C comp -a addr -e ep -n name -d data_file<span class="token punctuation">[</span>:data_file<span class="token punctuation">..</span>.<span class="token punctuation">]</span> image
          -A <span class="token operator">==</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> architecture to <span class="token string">'arch'</span> //设定架构：arm，mips，x86
          -O <span class="token operator">==</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> operating system to <span class="token string">'os'</span> //操作系统类型：linux，bsd，VxWorks
          -T <span class="token operator">==</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> image <span class="token builtin class-name">type</span> to <span class="token string">'type'</span> //镜像类型：kernel，ramdisk
          -C <span class="token operator">==</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> compression <span class="token builtin class-name">type</span> <span class="token string">'comp'</span> //压缩类型：gzip2，bzip2，none
          -a <span class="token operator">==</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> load address to <span class="token string">'addr'</span> <span class="token punctuation">(</span>hex<span class="token punctuation">)</span> //内核被加载到内存的地址<span class="token punctuation">(</span>参考值<span class="token punctuation">)</span>:0x20008000
          -e <span class="token operator">==</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> entry point to <span class="token string">'ep'</span> <span class="token punctuation">(</span>hex<span class="token punctuation">)</span> //内核被执行的地址<span class="token punctuation">(</span>参考值<span class="token punctuation">)</span>: 0x20008000
          -n <span class="token operator">==</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> image name to <span class="token string">'name'</span> //描述语句：自定义
          -d <span class="token operator">==</span><span class="token operator">&gt;</span> use image data from <span class="token string">'datafile'</span> //指定增加头部信息的文件---zImage
          -x <span class="token operator">==</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> XIP <span class="token punctuation">(</span>execute <span class="token keyword">in</span> place<span class="token punctuation">)</span>
       mkimage <span class="token punctuation">[</span>-D dtc_options<span class="token punctuation">]</span> <span class="token punctuation">[</span>-f fit-image.its<span class="token operator">|</span>-f auto<span class="token operator">|</span>-F<span class="token punctuation">]</span> <span class="token punctuation">[</span>-b <span class="token operator">&lt;</span>dtb<span class="token operator">&gt;</span> <span class="token punctuation">[</span>-b <span class="token operator">&lt;</span>dtb<span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>-i <span class="token operator">&lt;</span>ramdisk.cpio.gz<span class="token operator">&gt;</span><span class="token punctuation">]</span> fit-image
           <span class="token operator">&lt;</span>dtb<span class="token operator">&gt;</span> <span class="token function">file</span> is used with -f auto, it may occur multiple times.
          -D <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> all options <span class="token keyword">for</span> device tree compiler
          -f <span class="token operator">=</span><span class="token operator">&gt;</span> input filename <span class="token keyword">for</span> FIT <span class="token builtin class-name">source</span>
          -i <span class="token operator">=</span><span class="token operator">&gt;</span> input filename <span class="token keyword">for</span> ramdisk <span class="token function">file</span>
Signing / verified boot options: <span class="token punctuation">[</span>-E<span class="token punctuation">]</span> <span class="token punctuation">[</span>-B size<span class="token punctuation">]</span> <span class="token punctuation">[</span>-k keydir<span class="token punctuation">]</span> <span class="token punctuation">[</span>-K dtb<span class="token punctuation">]</span> <span class="token punctuation">[</span> -c <span class="token operator">&lt;</span>comment<span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>-p addr<span class="token punctuation">]</span> <span class="token punctuation">[</span>-r<span class="token punctuation">]</span> <span class="token punctuation">[</span>-N engine<span class="token punctuation">]</span>
          -E <span class="token operator">=</span><span class="token operator">&gt;</span> place data outside of the FIT structure
          -B <span class="token operator">=</span><span class="token operator">&gt;</span> align size <span class="token keyword">in</span> hex <span class="token keyword">for</span> FIT structure and header
          -k <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> directory containing private keys
          -K <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">write</span> public keys to this .dtb <span class="token function">file</span>
          -c <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">add</span> comment <span class="token keyword">in</span> signature <span class="token function">node</span>
          -F <span class="token operator">=</span><span class="token operator">&gt;</span> re-sign existing FIT image
          -p <span class="token operator">=</span><span class="token operator">&gt;</span> place external data at a static position
          -r <span class="token operator">=</span><span class="token operator">&gt;</span> mark keys used as <span class="token string">'required'</span> <span class="token keyword">in</span> dtb
          -N <span class="token operator">=</span><span class="token operator">&gt;</span> openssl engine to use <span class="token keyword">for</span> signing
       mkimage -V <span class="token operator">==</span><span class="token operator">&gt;</span> print version information and <span class="token builtin class-name">exit</span>
Use <span class="token string">'-T list'</span> to see a list of available image types


dwu@atc-dwu:~/samba/tftproot$ mkimage -A arm -O linux -T kernel -C none -a 0x30008000 -e 0x30008000 -n <span class="token string">"linux 3.0.8-jihq"</span> -d zImage uImage_hq
Image Name:   linux <span class="token number">3.0</span>.8-jihq
Created:      Fri Sep <span class="token number">30</span> <span class="token number">11</span>:57:40 <span class="token number">2022</span>
Image Type:   ARM Linux Kernel Image <span class="token punctuation">(</span>uncompressed<span class="token punctuation">)</span>
Data Size:    <span class="token number">2077840</span> Bytes <span class="token operator">=</span> <span class="token number">2029.14</span> KiB <span class="token operator">=</span> <span class="token number">1.98</span> MiB
Load Address: <span class="token number">30008000</span>
Entry Point:  <span class="token number">30008000</span>


x210 <span class="token comment"># tftp 40008000 uImage_hq</span>
dm9000 i/o: 0x88000300, id: 0x90000a46 
DM9000: running <span class="token keyword">in</span> <span class="token number">16</span> bit mode
MAC: 00:40:5c:26:0a:5b
operating at 100M full duplex mode
TFTP from server <span class="token number">192.100</span>.100.14<span class="token punctuation">;</span> our IP address is <span class="token number">192.100</span>.100.34
Filename <span class="token string">'uImage_hq'</span><span class="token builtin class-name">.</span>
Load address: 0x40008000
Loading: <span class="token comment">#################################################################</span>
     <span class="token comment">#################################################################</span>
     <span class="token comment">############</span>
<span class="token keyword">done</span>
Bytes transferred <span class="token operator">=</span> <span class="token number">2077904</span> <span class="token punctuation">(</span>0x1fb4d0<span class="token punctuation">)</span>
x210 <span class="token comment"># bootm 0x40008000</span>
get_format
-------- <span class="token number">1</span> --------
<span class="token comment">## Booting kernel from Legacy Image at 40008000 ...</span>
   Image Name:   linux <span class="token number">3.0</span>.8-jihq
   Created:      <span class="token number">2022</span>-09-30  <span class="token number">11</span>:57:40 UTC
   Image Type:   ARM Linux Kernel Image <span class="token punctuation">(</span>uncompressed<span class="token punctuation">)</span>
   Data Size:    <span class="token number">2077840</span> Bytes <span class="token operator">=</span>  <span class="token number">2</span> MB
   Load Address: <span class="token number">30008000</span>
   Entry Point:  <span class="token number">30008000</span>
   Verifying Checksum <span class="token punctuation">..</span>. OK
get_format
-------- <span class="token number">1</span> --------
   Loading Kernel Image <span class="token punctuation">..</span>. OK
OK

Starting kernel <span class="token punctuation">..</span>.

Uncompressing Linux<span class="token punctuation">..</span>. done, booting the kernel.</code></pre>
</blockquote>
<blockquote>
<p>Linux内核的压缩过程</p>
<p><img alt="" src="file:///F:/02-src/driver_study/mydrv/images/2022-09-30-20-10-43-image.png"></p>
</blockquote>
<blockquote>
<p>u-boot是如何启动内核的？</p>
<p>u-boot启动内核的过程图</p>
<p><img alt="" src="file:///F:/02-src/driver_study/mydrv/images/2022-09-30-20-41-15-image.png"></p>
<p>u-boot在交控制权之前，会将内核参数放在物理内存起始+0x100处，以及机器ID传给r1寄存器，然后调用</p>
<pre><code class="fenced-code-block language-c"><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>thekernel<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> machineid<span class="token punctuation">,</span> boot_params<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<pre><code class="fenced-code-block language-c"><span class="token function">MACHINE_START</span><span class="token punctuation">(</span>SMDKV210<span class="token punctuation">,</span> <span class="token string">"SMDKV210"</span><span class="token punctuation">)</span>
    <span class="token comment">/* Maintainer: Kukjin Kim &lt;kgene.kim@samsung.com&gt; */</span>
    <span class="token punctuation">.</span>boot_params<span class="token operator">=</span> S5P_PA_SDRAM <span class="token operator">+</span> <span class="token number">0x100</span><span class="token punctuation">,</span> <span class="token comment">//0x30000000 + 0x100，参数固定放在物理内存起始+0x100处</span>
    <span class="token punctuation">.</span>init_irq    <span class="token operator">=</span> s5pv210_init_irq<span class="token punctuation">,</span>
    <span class="token punctuation">.</span>map_io        <span class="token operator">=</span> smdkv210_map_io<span class="token punctuation">,</span>
    <span class="token punctuation">.</span>init_machine    <span class="token operator">=</span> smdkv210_machine_init<span class="token punctuation">,</span>
    <span class="token punctuation">.</span>timer        <span class="token operator">=</span> <span class="token operator">&amp;</span>s5p_timer<span class="token punctuation">,</span>
MACHINE_END</code></pre>
</blockquote>
<blockquote>
<p>内核的内部构造</p>
<p>全局图像</p>
<p><img alt="" src="file:///F:/02-src/driver_study/mydrv/images/2022-10-01-16-58-15-image.png"></p>
<p>首先要看连接脚本</p>
<pre><code class="fenced-code-block language-shell"><span class="token function">vim</span> Makefile
<span class="token comment">#搜索vmlinux</span>
<span class="token number">560</span> all: vmlinux
<span class="token number">731</span> <span class="token comment"># Build vmlinux</span>
<span class="token number">732</span> <span class="token comment"># ---------------------------------------------------------------------------</span>
<span class="token number">733</span> <span class="token comment"># vmlinux is built from the objects selected by $(vmlinux-init) and</span>
<span class="token number">734</span> <span class="token comment"># $(vmlinux-main). Most are built-in.o files from top-level directories</span>
<span class="token number">735</span> <span class="token comment"># in the kernel tree, others are specified in arch/$(ARCH)/Makefile.</span>
<span class="token number">736</span> <span class="token comment"># Ordering when linking is important, and $(vmlinux-init) must be first.</span>
<span class="token number">737</span> <span class="token comment">#</span>
<span class="token number">738</span> <span class="token comment"># vmlinux</span>
<span class="token number">739</span> <span class="token comment">#   ^</span>
<span class="token number">740</span> <span class="token comment">#   |</span>
<span class="token number">741</span> <span class="token comment">#   +-&lt; $(vmlinux-init)</span>
<span class="token number">742</span> <span class="token comment">#   |   +--&lt; init/version.o + more</span>
<span class="token number">743</span> <span class="token comment">#   |</span>
<span class="token number">744</span> <span class="token comment">#   +--&lt; $(vmlinux-main)</span>
<span class="token number">745</span> <span class="token comment">#   |    +--&lt; driver/built-in.o mm/built-in.o + more</span>
<span class="token number">746</span> <span class="token comment">#   |</span>
<span class="token number">747</span> <span class="token comment">#   +-&lt; kallsyms.o (see description in CONFIG_KALLSYMS section)</span>

<span class="token number">758</span> vmlinux-init :<span class="token operator">=</span> <span class="token variable"><span class="token variable">$(</span>head-y<span class="token variable">)</span></span> <span class="token variable"><span class="token variable">$(</span>init-y<span class="token variable">)</span></span>
<span class="token number">759</span> vmlinux-main :<span class="token operator">=</span> <span class="token variable"><span class="token variable">$(</span>core-y<span class="token variable">)</span></span> <span class="token variable"><span class="token variable">$(</span>libs-y<span class="token variable">)</span></span> <span class="token variable"><span class="token variable">$(</span>drivers-y<span class="token variable">)</span></span> <span class="token variable"><span class="token variable">$(</span>net-y<span class="token variable">)</span></span>
<span class="token number">760</span> vmlinux-all  :<span class="token operator">=</span> <span class="token variable"><span class="token variable">$(</span>vmlinux-init<span class="token variable">)</span></span> <span class="token variable"><span class="token variable">$(</span>vmlinux-main<span class="token variable">)</span></span>
<span class="token number">761</span> vmlinux-lds  :<span class="token operator">=</span> arch/<span class="token variable"><span class="token variable">$(</span>SRCARCH<span class="token variable">)</span></span>/kernel/vmlinux.lds</code></pre>
<p>所以链接脚本在arch/arm/kernel/vmlinux.lds
链接就是将elf文件相同的段(.bss, .data, .text)合并在一起
合并到同一文件的源elf文件的排列顺序默认按照先后顺序排，链接脚本可以改变这种顺序</p>
<p><strong>有链接脚本，先后顺序按链接脚本的排列</strong></p>
<p>链接过程图</p>
<p><img alt="" src="file:///F:/02-src/driver_study/mydrv/images/2022-09-30-20-58-56-image.png"></p>
</blockquote>
<blockquote>
<p>基本的链接脚本</p>
<pre><code class="fenced-code-block language-shell">ld -T连接脚本.lds -Ttext 0x30008000 *.o -o elfname
-T 指定链接脚本
-Ttext 指定text段的链接地址，可以覆盖链接脚本中的text段的起始地址


tftp <span class="token number">40008000</span> uImage 是将uImage暂存在0x40008000处，暂存地址随意，但不可以是0x30008000，
因为u-boot读取ep入口地址为0x30008000时，会将zImage拷贝到30008000的位置，可能会把后面的
zImage覆盖掉
一般将uImage下载到入口地址 + zImage长度的任意位置</code></pre>
<pre><code class="fenced-code-block language-shell">OUTPUT_ARCH<span class="token punctuation">(</span>arm<span class="token punctuation">)</span> <span class="token comment">#输出格式为arm架构</span>
ENTRY<span class="token punctuation">(</span>_start<span class="token punctuation">)</span>    <span class="token comment">#表示指定入口标签，第一个执行函数</span>
SECTIONS        <span class="token comment">#指定目标文件所有段的排布</span>
<span class="token punctuation">{</span>
    <span class="token builtin class-name">.</span> <span class="token operator">=</span> 0x30008000<span class="token punctuation">;</span> <span class="token comment"># . 表示当前的位置，依次从当前位置网上堆叠</span>
    .text <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>        <span class="token comment">#表示目标文件的text段由哪些elf文件的text段组成</span>
        start.o <span class="token punctuation">(</span>.text<span class="token punctuation">)</span> <span class="token comment">#强行指定start.o的text段排在最前面</span>
        ledc.o <span class="token punctuation">(</span>.text<span class="token punctuation">)</span>
        * <span class="token punctuation">(</span>.text<span class="token punctuation">)</span>    <span class="token comment"># * 表示其他的文件，先后顺序按makefile的先后排布</span>
    <span class="token punctuation">}</span>
    .rodata <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        * <span class="token punctuation">(</span>.rodata<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    .data <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        * <span class="token punctuation">(</span>.data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    .bss <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        __bss_start <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> <span class="token comment">#记录bss段的起始位置</span>
        * <span class="token punctuation">(</span>.bss<span class="token punctuation">)</span>
        __bss_end <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> <span class="token comment">#记录bss段的结束位置</span>
        <span class="token comment">#记录bss段的起始和结束位置是为了清bss使用</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
</blockquote>
<blockquote>
<p>内核的启动及其内部构造</p>
<pre><code class="fenced-code-block language-shell">OUTPUT_ARCH<span class="token punctuation">(</span>arm<span class="token punctuation">)</span>
ENTRY<span class="token punctuation">(</span>stext<span class="token punctuation">)</span>
jiffies <span class="token operator">=</span> jiffies_64<span class="token punctuation">;</span>
SECTIONS
<span class="token punctuation">{</span>
 <span class="token builtin class-name">.</span> <span class="token operator">=</span> 0xC0000000 + 0x00008000<span class="token punctuation">;</span>
 .init <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> /* Init code and data        */
  _stext <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span>
  _sinittext <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span>
   *<span class="token punctuation">(</span>.head.text<span class="token punctuation">)</span>
   *<span class="token punctuation">(</span>.init.text<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.cpuinit.text<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.meminit.text<span class="token punctuation">)</span>

  _einittext <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span>
  __proc_info_begin <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span>
    *<span class="token punctuation">(</span>.proc.info.init<span class="token punctuation">)</span> <span class="token comment">#处理器信息段</span>
  __proc_info_end <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span>
  __arch_info_begin <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span>
   *<span class="token punctuation">(</span>.arch.info.init<span class="token punctuation">)</span> <span class="token comment">#机器信息段,对象</span>
  __arch_info_end <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span>
  __tagtable_begin <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span>
   *<span class="token punctuation">(</span>.taglist.init<span class="token punctuation">)</span> <span class="token comment">#u-boot传递bootargs数据的处理段</span>
  __tagtable_end <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span>
  __pv_table_begin <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span>
   *<span class="token punctuation">(</span>.pv_table<span class="token punctuation">)</span>
  __pv_table_end <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span>
  <span class="token builtin class-name">.</span> <span class="token operator">=</span> ALIGN<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  __setup_start <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> 
  *<span class="token punctuation">(</span>.init.setup<span class="token punctuation">)</span>    <span class="token comment"># booargs中各个参数的处理段</span>
  __setup_end <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span>
  __initcall_start <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> 
  *<span class="token punctuation">(</span>.initcallearly.init<span class="token punctuation">)</span>

  <span class="token comment">#驱动函数执行段，这个段全部是函数指针</span>
  <span class="token comment">#如果批量执行这里的所有函数指针，驱动的入口函数就会被执行</span>
  <span class="token comment">#内核启动时，通过二级指针遍历这些函数指针进行执行，则所有驱动就会运行</span>
  __early_initcall_end <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> 
  *<span class="token punctuation">(</span>.initcall0.init<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.initcall0s.init<span class="token punctuation">)</span> 
  *<span class="token punctuation">(</span>.initcall1.init<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.initcall1s.init<span class="token punctuation">)</span> 
  *<span class="token punctuation">(</span>.initcall2.init<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.initcall2s.init<span class="token punctuation">)</span> 
  *<span class="token punctuation">(</span>.initcall3.init<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.initcall3s.init<span class="token punctuation">)</span> 
  *<span class="token punctuation">(</span>.initcall4.init<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.initcall4s.init<span class="token punctuation">)</span> <span class="token comment"># subsys_initcall</span>
  *<span class="token punctuation">(</span>.initcall5.init<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.initcall5s.init<span class="token punctuation">)</span> 
  *<span class="token punctuation">(</span>.initcallrootfs.init<span class="token punctuation">)</span> 
  *<span class="token punctuation">(</span>.initcall6.init<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.initcall6s.init<span class="token punctuation">)</span> <span class="token comment">#module_init</span>
  *<span class="token punctuation">(</span>.initcall7.init<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.initcall7s.init<span class="token punctuation">)</span> 
  __initcall_end <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span>
  __con_initcall_start <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>.con_initcall.init<span class="token punctuation">)</span> __con_initcall_end <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span>
  __security_initcall_start <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>.security_initcall.init<span class="token punctuation">)</span> __security_initcall_end <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span>
  <span class="token builtin class-name">.</span> <span class="token operator">=</span> ALIGN<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> __initramfs_start <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>.init.ramfs<span class="token punctuation">)</span> <span class="token builtin class-name">.</span> <span class="token operator">=</span> ALIGN<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>.init.ramfs.info<span class="token punctuation">)</span>
  __init_begin <span class="token operator">=</span> _stext<span class="token punctuation">;</span>
  *<span class="token punctuation">(</span>.init.data<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.cpuinit.data<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.meminit.data<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.init.rodata<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.cpuinit.rodata<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.meminit.rodata<span class="token punctuation">)</span> <span class="token builtin class-name">.</span> <span class="token operator">=</span> ALIGN<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span> __dtb_start <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>.dtb.init.rodata<span class="token punctuation">)</span> __dtb_end <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span>

 <span class="token punctuation">}</span>
 <span class="token builtin class-name">.</span> <span class="token operator">=</span> ALIGN<span class="token variable"><span class="token punctuation">((</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">12</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span> .data<span class="token punctuation">..</span>percpu <span class="token builtin class-name">:</span> AT<span class="token punctuation">(</span>ADDR<span class="token punctuation">(</span>.data<span class="token punctuation">..</span>percpu<span class="token punctuation">)</span> - <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> __per_cpu_load <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> __per_cpu_start <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>.data<span class="token punctuation">..</span>percpu<span class="token punctuation">..</span>first<span class="token punctuation">)</span> <span class="token builtin class-name">.</span> <span class="token operator">=</span> ALIGN<span class="token variable"><span class="token punctuation">((</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">12</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>.data<span class="token punctuation">..</span>percpu<span class="token punctuation">..</span>page_aligned<span class="token punctuation">)</span> <span class="token builtin class-name">.</span> <span class="token operator">=</span> ALIGN<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>.data<span class="token punctuation">..</span>percpu<span class="token punctuation">..</span>readmostly<span class="token punctuation">)</span> <span class="token builtin class-name">.</span> <span class="token operator">=</span> ALIGN<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>.data<span class="token punctuation">..</span>percpu<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.data<span class="token punctuation">..</span>percpu<span class="token punctuation">..</span>shared_aligned<span class="token punctuation">)</span> __per_cpu_end <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
 <span class="token builtin class-name">.</span> <span class="token operator">=</span> ALIGN<span class="token variable"><span class="token punctuation">((</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">12</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span>
 __init_end <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span>
 /*
     * unwind <span class="token builtin class-name">exit</span> sections must be discarded before the rest of the
     * unwind sections get included.
     */
 /DISCARD/ <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
  *<span class="token punctuation">(</span>.ARM.exidx.exit.text<span class="token punctuation">)</span>
  *<span class="token punctuation">(</span>.ARM.extab.exit.text<span class="token punctuation">)</span>
  *<span class="token punctuation">(</span>.ARM.exidx.cpuexit.text<span class="token punctuation">)</span>
  *<span class="token punctuation">(</span>.ARM.extab.cpuexit.text<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
 .text <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> /* Real text segment        */
  _text <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> /* Text and read-only data    */
   __exception_text_start <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span>
   *<span class="token punctuation">(</span>.exception.text<span class="token punctuation">)</span>
   __exception_text_end <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span>

   <span class="token builtin class-name">.</span> <span class="token operator">=</span> ALIGN<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>.text.hot<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.text<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.ref.text<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.devinit.text<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.devexit.text<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.text.unlikely<span class="token punctuation">)</span>
   <span class="token builtin class-name">.</span> <span class="token operator">=</span> ALIGN<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> __sched_text_start <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>.sched.text<span class="token punctuation">)</span> __sched_text_end <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span>
   <span class="token builtin class-name">.</span> <span class="token operator">=</span> ALIGN<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> __lock_text_start <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>.spinlock.text<span class="token punctuation">)</span> __lock_text_end <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span>
   <span class="token builtin class-name">.</span> <span class="token operator">=</span> ALIGN<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> __kprobes_text_start <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>.kprobes.text<span class="token punctuation">)</span> __kprobes_text_end <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span>
   *<span class="token punctuation">(</span>.fixup<span class="token punctuation">)</span>
   *<span class="token punctuation">(</span>.gnu.warning<span class="token punctuation">)</span>
   *<span class="token punctuation">(</span>.rodata<span class="token punctuation">)</span>
   *<span class="token punctuation">(</span>.rodata.*<span class="token punctuation">)</span>
   *<span class="token punctuation">(</span>.glue_7<span class="token punctuation">)</span>
   *<span class="token punctuation">(</span>.glue_7t<span class="token punctuation">)</span>
  <span class="token builtin class-name">.</span> <span class="token operator">=</span> ALIGN<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  *<span class="token punctuation">(</span>.got<span class="token punctuation">)</span> /* Global offset table        */

 <span class="token punctuation">}</span>
 <span class="token builtin class-name">.</span> <span class="token operator">=</span> ALIGN<span class="token variable"><span class="token punctuation">((</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">12</span><span class="token punctuation">))</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> .rodata <span class="token builtin class-name">:</span> AT<span class="token punctuation">(</span>ADDR<span class="token punctuation">(</span>.rodata<span class="token punctuation">)</span> - <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> __start_rodata <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>.rodata<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.rodata.*<span class="token punctuation">)</span> *<span class="token punctuation">(</span>__vermagic<span class="token punctuation">)</span> <span class="token builtin class-name">.</span> <span class="token operator">=</span> ALIGN<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> __start___tracepoints_ptrs <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>__tracepoints_ptrs<span class="token punctuation">)</span> __stop___tracepoints_ptrs <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>__markers_strings<span class="token punctuation">)</span> *<span class="token punctuation">(</span>__tracepoints_strings<span class="token punctuation">)</span> <span class="token punctuation">}</span> .rodata1 <span class="token builtin class-name">:</span> AT<span class="token punctuation">(</span>ADDR<span class="token punctuation">(</span>.rodata1<span class="token punctuation">)</span> - <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> *<span class="token punctuation">(</span>.rodata1<span class="token punctuation">)</span> <span class="token punctuation">}</span> .pci_fixup <span class="token builtin class-name">:</span> AT<span class="token punctuation">(</span>ADDR<span class="token punctuation">(</span>.pci_fixup<span class="token punctuation">)</span> - <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> __start_pci_fixups_early <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>.pci_fixup_early<span class="token punctuation">)</span> __end_pci_fixups_early <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> __start_pci_fixups_header <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>.pci_fixup_header<span class="token punctuation">)</span> __end_pci_fixups_header <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> __start_pci_fixups_final <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>.pci_fixup_final<span class="token punctuation">)</span> __end_pci_fixups_final <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> __start_pci_fixups_enable <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>.pci_fixup_enable<span class="token punctuation">)</span> __end_pci_fixups_enable <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> __start_pci_fixups_resume <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>.pci_fixup_resume<span class="token punctuation">)</span> __end_pci_fixups_resume <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> __start_pci_fixups_resume_early <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>.pci_fixup_resume_early<span class="token punctuation">)</span> __end_pci_fixups_resume_early <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> __start_pci_fixups_suspend <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>.pci_fixup_suspend<span class="token punctuation">)</span> __end_pci_fixups_suspend <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> .builtin_fw <span class="token builtin class-name">:</span> AT<span class="token punctuation">(</span>ADDR<span class="token punctuation">(</span>.builtin_fw<span class="token punctuation">)</span> - <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> __start_builtin_fw <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>.builtin_fw<span class="token punctuation">)</span> __end_builtin_fw <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> .rio_ops <span class="token builtin class-name">:</span> AT<span class="token punctuation">(</span>ADDR<span class="token punctuation">(</span>.rio_ops<span class="token punctuation">)</span> - <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> __start_rio_switch_ops <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>.rio_switch_ops<span class="token punctuation">)</span> __end_rio_switch_ops <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> __ksymtab <span class="token builtin class-name">:</span> AT<span class="token punctuation">(</span>ADDR<span class="token punctuation">(</span>__ksymtab<span class="token punctuation">)</span> - <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> __start___ksymtab <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>SORT<span class="token punctuation">(</span>___ksymtab+*<span class="token punctuation">))</span> __stop___ksymtab <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> __ksymtab_gpl <span class="token builtin class-name">:</span> AT<span class="token punctuation">(</span>ADDR<span class="token punctuation">(</span>__ksymtab_gpl<span class="token punctuation">)</span> - <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> __start___ksymtab_gpl <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>SORT<span class="token punctuation">(</span>___ksymtab_gpl+*<span class="token punctuation">))</span> __stop___ksymtab_gpl <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> __ksymtab_unused <span class="token builtin class-name">:</span> AT<span class="token punctuation">(</span>ADDR<span class="token punctuation">(</span>__ksymtab_unused<span class="token punctuation">)</span> - <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> __start___ksymtab_unused <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>SORT<span class="token punctuation">(</span>___ksymtab_unused+*<span class="token punctuation">))</span> __stop___ksymtab_unused <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> __ksymtab_unused_gpl <span class="token builtin class-name">:</span> AT<span class="token punctuation">(</span>ADDR<span class="token punctuation">(</span>__ksymtab_unused_gpl<span class="token punctuation">)</span> - <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> __start___ksymtab_unused_gpl <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>SORT<span class="token punctuation">(</span>___ksymtab_unused_gpl+*<span class="token punctuation">))</span> __stop___ksymtab_unused_gpl <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> __ksymtab_gpl_future <span class="token builtin class-name">:</span> AT<span class="token punctuation">(</span>ADDR<span class="token punctuation">(</span>__ksymtab_gpl_future<span class="token punctuation">)</span> - <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> __start___ksymtab_gpl_future <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>SORT<span class="token punctuation">(</span>___ksymtab_gpl_future+*<span class="token punctuation">))</span> __stop___ksymtab_gpl_future <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> __kcrctab <span class="token builtin class-name">:</span> AT<span class="token punctuation">(</span>ADDR<span class="token punctuation">(</span>__kcrctab<span class="token punctuation">)</span> - <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> __start___kcrctab <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>SORT<span class="token punctuation">(</span>___kcrctab+*<span class="token punctuation">))</span> __stop___kcrctab <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> __kcrctab_gpl <span class="token builtin class-name">:</span> AT<span class="token punctuation">(</span>ADDR<span class="token punctuation">(</span>__kcrctab_gpl<span class="token punctuation">)</span> - <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> __start___kcrctab_gpl <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>SORT<span class="token punctuation">(</span>___kcrctab_gpl+*<span class="token punctuation">))</span> __stop___kcrctab_gpl <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> __kcrctab_unused <span class="token builtin class-name">:</span> AT<span class="token punctuation">(</span>ADDR<span class="token punctuation">(</span>__kcrctab_unused<span class="token punctuation">)</span> - <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> __start___kcrctab_unused <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>SORT<span class="token punctuation">(</span>___kcrctab_unused+*<span class="token punctuation">))</span> __stop___kcrctab_unused <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> __kcrctab_unused_gpl <span class="token builtin class-name">:</span> AT<span class="token punctuation">(</span>ADDR<span class="token punctuation">(</span>__kcrctab_unused_gpl<span class="token punctuation">)</span> - <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> __start___kcrctab_unused_gpl <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>SORT<span class="token punctuation">(</span>___kcrctab_unused_gpl+*<span class="token punctuation">))</span> __stop___kcrctab_unused_gpl <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> __kcrctab_gpl_future <span class="token builtin class-name">:</span> AT<span class="token punctuation">(</span>ADDR<span class="token punctuation">(</span>__kcrctab_gpl_future<span class="token punctuation">)</span> - <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> __start___kcrctab_gpl_future <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>SORT<span class="token punctuation">(</span>___kcrctab_gpl_future+*<span class="token punctuation">))</span> __stop___kcrctab_gpl_future <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> __ksymtab_strings <span class="token builtin class-name">:</span> AT<span class="token punctuation">(</span>ADDR<span class="token punctuation">(</span>__ksymtab_strings<span class="token punctuation">)</span> - <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> *<span class="token punctuation">(</span>__ksymtab_strings<span class="token punctuation">)</span> <span class="token punctuation">}</span> __init_rodata <span class="token builtin class-name">:</span> AT<span class="token punctuation">(</span>ADDR<span class="token punctuation">(</span>__init_rodata<span class="token punctuation">)</span> - <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> *<span class="token punctuation">(</span>.ref.rodata<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.devinit.rodata<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.devexit.rodata<span class="token punctuation">)</span> <span class="token punctuation">}</span> __param <span class="token builtin class-name">:</span> AT<span class="token punctuation">(</span>ADDR<span class="token punctuation">(</span>__param<span class="token punctuation">)</span> - <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> __start___param <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>__param<span class="token punctuation">)</span> __stop___param <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> __modver <span class="token builtin class-name">:</span> AT<span class="token punctuation">(</span>ADDR<span class="token punctuation">(</span>__modver<span class="token punctuation">)</span> - <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> __start___modver <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>__modver<span class="token punctuation">)</span> __stop___modver <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> <span class="token builtin class-name">.</span> <span class="token operator">=</span> ALIGN<span class="token variable"><span class="token punctuation">((</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">12</span><span class="token punctuation">))</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> __end_rodata <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token builtin class-name">.</span> <span class="token operator">=</span> ALIGN<span class="token variable"><span class="token punctuation">((</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">12</span><span class="token punctuation">))</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 /*
     * Stack unwinding tables
     */
 <span class="token builtin class-name">.</span> <span class="token operator">=</span> ALIGN<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 .ARM.unwind_idx <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
  __start_unwind_idx <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span>
  *<span class="token punctuation">(</span>.ARM.exidx*<span class="token punctuation">)</span>
  __stop_unwind_idx <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 .ARM.unwind_tab <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
  __start_unwind_tab <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span>
  *<span class="token punctuation">(</span>.ARM.extab*<span class="token punctuation">)</span>
  __stop_unwind_tab <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 _etext <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> /* End of text and rodata section */
 <span class="token builtin class-name">.</span> <span class="token operator">=</span> ALIGN<span class="token punctuation">(</span><span class="token number">8192</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 __data_loc <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span>
 .data <span class="token builtin class-name">:</span> AT<span class="token punctuation">(</span>__data_loc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  _data <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> /* address <span class="token keyword">in</span> memory */
  _sdata <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span>
  /*
         * first, the init task union, aligned
         * to an <span class="token number">8192</span> byte boundary.
         */
  <span class="token builtin class-name">.</span> <span class="token operator">=</span> ALIGN<span class="token punctuation">(</span><span class="token number">8192</span><span class="token punctuation">)</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>.data<span class="token punctuation">..</span>init_task<span class="token punctuation">)</span>
  <span class="token builtin class-name">.</span> <span class="token operator">=</span> ALIGN<span class="token variable"><span class="token punctuation">((</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">12</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span> __nosave_begin <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>.data<span class="token punctuation">..</span>nosave<span class="token punctuation">)</span> <span class="token builtin class-name">.</span> <span class="token operator">=</span> ALIGN<span class="token variable"><span class="token punctuation">((</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">12</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span> __nosave_end <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span>
  <span class="token builtin class-name">.</span> <span class="token operator">=</span> ALIGN<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>.data<span class="token punctuation">..</span>cacheline_aligned<span class="token punctuation">)</span>
  <span class="token builtin class-name">.</span> <span class="token operator">=</span> ALIGN<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>.data<span class="token punctuation">..</span>read_mostly<span class="token punctuation">)</span> <span class="token builtin class-name">.</span> <span class="token operator">=</span> ALIGN<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  /*
         * The exception fixup table <span class="token punctuation">(</span>might need resorting at runtime<span class="token punctuation">)</span>
         */
  <span class="token builtin class-name">.</span> <span class="token operator">=</span> ALIGN<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  __start___ex_table <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span>
  *<span class="token punctuation">(</span>__ex_table<span class="token punctuation">)</span>
  __stop___ex_table <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span>
  /*
         * and the usual data section
         */
  *<span class="token punctuation">(</span>.data<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.ref.data<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.data<span class="token punctuation">..</span>shared_aligned<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.devinit.data<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.devexit.data<span class="token punctuation">)</span> <span class="token builtin class-name">.</span> <span class="token operator">=</span> ALIGN<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>__tracepoints<span class="token punctuation">)</span> <span class="token builtin class-name">.</span> <span class="token operator">=</span> ALIGN<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> __start___jump_table <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>__jump_table<span class="token punctuation">)</span> __stop___jump_table <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> <span class="token builtin class-name">.</span> <span class="token operator">=</span> ALIGN<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> __start___verbose <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>__verbose<span class="token punctuation">)</span> __stop___verbose <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span>
  CONSTRUCTORS
  _edata <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 _edata_loc <span class="token operator">=</span> __data_loc + SIZEOF<span class="token punctuation">(</span>.data<span class="token punctuation">)</span><span class="token punctuation">;</span>
 .notes <span class="token builtin class-name">:</span> AT<span class="token punctuation">(</span>ADDR<span class="token punctuation">(</span>.notes<span class="token punctuation">)</span> - <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> __start_notes <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> *<span class="token punctuation">(</span>.note.*<span class="token punctuation">)</span> __stop_notes <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
 <span class="token builtin class-name">.</span> <span class="token operator">=</span> ALIGN<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> __bss_start <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span> <span class="token builtin class-name">.</span> <span class="token operator">=</span> ALIGN<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> .sbss <span class="token builtin class-name">:</span> AT<span class="token punctuation">(</span>ADDR<span class="token punctuation">(</span>.sbss<span class="token punctuation">)</span> - <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> *<span class="token punctuation">(</span>.sbss<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.scommon<span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token builtin class-name">.</span> <span class="token operator">=</span> ALIGN<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> .bss <span class="token builtin class-name">:</span> AT<span class="token punctuation">(</span>ADDR<span class="token punctuation">(</span>.bss<span class="token punctuation">)</span> - <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> *<span class="token punctuation">(</span>.bss<span class="token punctuation">..</span>page_aligned<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.dynbss<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.bss<span class="token punctuation">)</span> *<span class="token punctuation">(</span>COMMON<span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token builtin class-name">.</span> <span class="token operator">=</span> ALIGN<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> __bss_stop <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span>
 _end <span class="token operator">=</span> <span class="token builtin class-name">.</span><span class="token punctuation">;</span>
 .stab <span class="token number">0</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> *<span class="token punctuation">(</span>.stab<span class="token punctuation">)</span> <span class="token punctuation">}</span> .stabstr <span class="token number">0</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> *<span class="token punctuation">(</span>.stabstr<span class="token punctuation">)</span> <span class="token punctuation">}</span> .stab.excl <span class="token number">0</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> *<span class="token punctuation">(</span>.stab.excl<span class="token punctuation">)</span> <span class="token punctuation">}</span> .stab.exclstr <span class="token number">0</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> *<span class="token punctuation">(</span>.stab.exclstr<span class="token punctuation">)</span> <span class="token punctuation">}</span> .stab.index <span class="token number">0</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> *<span class="token punctuation">(</span>.stab.index<span class="token punctuation">)</span> <span class="token punctuation">}</span> .stab.indexstr <span class="token number">0</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> *<span class="token punctuation">(</span>.stab.indexstr<span class="token punctuation">)</span> <span class="token punctuation">}</span> .comment <span class="token number">0</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> *<span class="token punctuation">(</span>.comment<span class="token punctuation">)</span> <span class="token punctuation">}</span>
 .comment <span class="token number">0</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> *<span class="token punctuation">(</span>.comment<span class="token punctuation">)</span> <span class="token punctuation">}</span>
 /* Default discards */
 /DISCARD/ <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> *<span class="token punctuation">(</span>.exit.text<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.cpuexit.text<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.memexit.text<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.exit.data<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.cpuexit.data<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.cpuexit.rodata<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.memexit.data<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.memexit.rodata<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.exitcall.exit<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.discard<span class="token punctuation">)</span> *<span class="token punctuation">(</span>.discard.*<span class="token punctuation">)</span> <span class="token punctuation">}</span>
 /DISCARD/ <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
  *<span class="token punctuation">(</span>.alt.smp.init<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
/*
 * These must never be empty
 * If you have to comment these two assert statements out, your
 * binutils is too old <span class="token punctuation">(</span>for other reasons as well<span class="token punctuation">)</span>
 */
ASSERT<span class="token punctuation">((</span>__proc_info_end - __proc_info_begin<span class="token punctuation">)</span>, <span class="token string">"missing CPU support"</span><span class="token punctuation">)</span>
ASSERT<span class="token punctuation">((</span>__arch_info_end - __arch_info_begin<span class="token punctuation">)</span>, <span class="token string">"no machine record defined"</span><span class="token punctuation">)</span></code></pre>
</blockquote>
<blockquote>
<p>module_init解析</p>
<pre><code class="fenced-code-block language-c"><span class="token function">module_init</span><span class="token punctuation">(</span>led_drv_init<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//是一个函数指针，指针指向参数</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">module_init</span><span class="token expression"><span class="token punctuation">(</span>x<span class="token punctuation">)</span>    <span class="token function">__initcall</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span></span></span>
  <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">__initcall</span><span class="token expression"><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token function">device_initcall</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span></span></span>
    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">device_initcall</span><span class="token expression"><span class="token punctuation">(</span>fn<span class="token punctuation">)</span>        <span class="token function">__define_initcall</span><span class="token punctuation">(</span></span><span class="token string">"6"</span><span class="token expression"><span class="token punctuation">,</span>fn<span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span></span></span>
      <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">__define_initcall</span><span class="token expression"><span class="token punctuation">(</span>level<span class="token punctuation">,</span>fn<span class="token punctuation">,</span>id<span class="token punctuation">)</span> </span><span class="token punctuation">\</span>
    <span class="token expression"><span class="token keyword">static</span> <span class="token class-name">initcall_t</span> __initcall_</span><span class="token punctuation">##</span><span class="token expression">fn</span><span class="token punctuation">##</span><span class="token expression">id __used </span><span class="token punctuation">\</span>
    <span class="token expression"><span class="token keyword">__attribute__</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">__section__</span><span class="token punctuation">(</span></span><span class="token string">".initcall"</span> <span class="token expression">level </span><span class="token string">".init"</span><span class="token expression"><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> fn</span></span>

<span class="token keyword">typedef</span> <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token class-name">initcall_t</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token class-name">initcall_t</span> __initcall_led_drv_init6 __used <span class="token keyword">__attribute__</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">__section__</span><span class="token punctuation">(</span><span class="token string">".initcall6.init"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> led_drv_init</code></pre>
</blockquote>
<blockquote>
<pre><code class="fenced-code-block language-c"><span class="token function">MACHINE_START</span><span class="token punctuation">(</span>SMDKV210<span class="token punctuation">,</span> <span class="token string">"SMDKV210"</span><span class="token punctuation">)</span>
    <span class="token comment">/* Maintainer: Kukjin Kim &lt;kgene.kim@samsung.com&gt; */</span>
    <span class="token punctuation">.</span>boot_params<span class="token operator">=</span> S5P_PA_SDRAM <span class="token operator">+</span> <span class="token number">0x100</span><span class="token punctuation">,</span> <span class="token comment">//0x30000000 + 0x100，参数固定放在物理内存起始+0x100处</span>
    <span class="token punctuation">.</span>init_irq    <span class="token operator">=</span> s5pv210_init_irq<span class="token punctuation">,</span>
    <span class="token punctuation">.</span>map_io        <span class="token operator">=</span> smdkv210_map_io<span class="token punctuation">,</span>
    <span class="token punctuation">.</span>init_machine    <span class="token operator">=</span> smdkv210_machine_init<span class="token punctuation">,</span>
    <span class="token punctuation">.</span>timer        <span class="token operator">=</span> <span class="token operator">&amp;</span>s5p_timer<span class="token punctuation">,</span>
MACHINE_END

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">MACHINE_START</span><span class="token expression"><span class="token punctuation">(</span>_type<span class="token punctuation">,</span>_name<span class="token punctuation">)</span>            </span><span class="token punctuation">\</span>
<span class="token expression"><span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">machine_desc</span> __mach_desc_</span><span class="token punctuation">##</span><span class="token expression">_type    </span><span class="token punctuation">\</span>
 <span class="token expression">__used                            </span><span class="token punctuation">\</span>
 <span class="token expression"><span class="token keyword">__attribute__</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">__section__</span><span class="token punctuation">(</span></span><span class="token string">".arch.info.init"</span><span class="token expression"><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    </span><span class="token punctuation">\</span>
    <span class="token expression"><span class="token punctuation">.</span>nr        <span class="token operator">=</span> MACH_TYPE_</span><span class="token punctuation">##</span><span class="token expression">_type<span class="token punctuation">,</span>        </span><span class="token punctuation">\</span>
    <span class="token expression"><span class="token punctuation">.</span>name        <span class="token operator">=</span> _name<span class="token punctuation">,</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MACHINE_END</span>                <span class="token punctuation">\</span>
<span class="token expression"><span class="token punctuation">}</span><span class="token punctuation">;</span>  </span></span>


<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">machine_desc</span> __mach_desc_SMDKV210 \
__used <span class="token keyword">__attribute__</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">__section__</span><span class="token punctuation">(</span><span class="token string">".arch.info.init"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span>nr        <span class="token operator">=</span> MACH_TYPE_SMDKV210<span class="token punctuation">,</span>        \
    <span class="token punctuation">.</span>name        <span class="token operator">=</span> <span class="token string">"SMDKV210"</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span>boot_params<span class="token operator">=</span> S5P_PA_SDRAM <span class="token operator">+</span> <span class="token number">0x100</span><span class="token punctuation">,</span> <span class="token comment">//0x30000000 + 0x100，参数固定放在物理内存起始+0x100处</span>
    <span class="token punctuation">.</span>init_irq    <span class="token operator">=</span> s5pv210_init_irq<span class="token punctuation">,</span>
    <span class="token punctuation">.</span>map_io        <span class="token operator">=</span> smdkv210_map_io<span class="token punctuation">,</span>
    <span class="token punctuation">.</span>init_machine    <span class="token operator">=</span> smdkv210_machine_init<span class="token punctuation">,</span>
    <span class="token punctuation">.</span>timer        <span class="token operator">=</span> <span class="token operator">&amp;</span>s5p_timer<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token punctuation">.</span>section <span class="token string">".proc.info.init"</span><span class="token punctuation">,</span> #alloc<span class="token punctuation">,</span> #execinstr

    <span class="token punctuation">.</span>type   __v7_ca9mp_proc_info<span class="token punctuation">,</span> #object
__v7_ca9mp_proc_info<span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token keyword">long</span>    <span class="token number">0x410fc090</span>        @ Required ID value
    <span class="token punctuation">.</span><span class="token keyword">long</span>    <span class="token number">0xff0ffff0</span>        @ Mask f        or ID
dwu@atc<span class="token operator">-</span>dwu<span class="token operator">:</span><span class="token operator">~</span><span class="token operator">/</span>samba<span class="token operator">/</span>linux<span class="token operator">-</span><span class="token number">3.0</span><span class="token number">.8</span>$ grep MACH_TYPE_SMDKV210 <span class="token operator">-</span>rHn <span class="token punctuation">.</span><span class="token operator">/</span>include<span class="token operator">/</span>
<span class="token punctuation">.</span><span class="token operator">/</span>include<span class="token operator">/</span>generated<span class="token operator">/</span>mach<span class="token operator">-</span>types<span class="token punctuation">.</span>h<span class="token operator">:</span><span class="token number">417</span><span class="token operator">:</span>#define MACH_TYPE_SMDKV210             <span class="token number">2456</span>
<span class="token punctuation">.</span><span class="token operator">/</span>include<span class="token operator">/</span>generated<span class="token operator">/</span>mach<span class="token operator">-</span>types<span class="token punctuation">.</span>h<span class="token operator">:</span><span class="token number">5937</span><span class="token operator">:</span>#  define machine_arch_type    MACH_TYPE_SMDKV210
<span class="token punctuation">.</span><span class="token operator">/</span>include<span class="token operator">/</span>generated<span class="token operator">/</span>mach<span class="token operator">-</span>types<span class="token punctuation">.</span>h<span class="token operator">:</span><span class="token number">5939</span><span class="token operator">:</span># define <span class="token function">machine_is_smdkv210</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">(</span>machine_arch_type <span class="token operator">==</span> MACH_TYPE_SMDKV210<span class="token punctuation">)</span>

<span class="token keyword">struct</span> <span class="token class-name">machine_desc</span> <span class="token punctuation">{</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span>        nr<span class="token punctuation">;</span>        <span class="token comment">/* architecture number    */</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span>        <span class="token operator">*</span>name<span class="token punctuation">;</span>        <span class="token comment">/* architecture name    */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span>        boot_params<span class="token punctuation">;</span>    <span class="token comment">/* tagged list        */</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span>        <span class="token operator">*</span><span class="token operator">*</span>dt_compat<span class="token punctuation">;</span>    <span class="token comment">/* array of device tree
                         * 'compatible' strings    */</span>

    <span class="token keyword">unsigned</span> <span class="token keyword">int</span>        nr_irqs<span class="token punctuation">;</span>    <span class="token comment">/* number of IRQs */</span>

    <span class="token keyword">unsigned</span> <span class="token keyword">int</span>        video_start<span class="token punctuation">;</span>    <span class="token comment">/* start of video RAM    */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span>        video_end<span class="token punctuation">;</span>    <span class="token comment">/* end of video RAM    */</span>

    <span class="token keyword">unsigned</span> <span class="token keyword">int</span>        reserve_lp0 <span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token comment">/* never has lp0    */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span>        reserve_lp1 <span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token comment">/* never has lp1    */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span>        reserve_lp2 <span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token comment">/* never has lp2    */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span>        soft_reboot <span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token comment">/* soft reboot        */</span>
    <span class="token keyword">void</span>            <span class="token punctuation">(</span><span class="token operator">*</span>fixup<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">machine_desc</span> <span class="token operator">*</span><span class="token punctuation">,</span>
                     <span class="token keyword">struct</span> <span class="token class-name">tag</span> <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">,</span>
                     <span class="token keyword">struct</span> <span class="token class-name">meminfo</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span>            <span class="token punctuation">(</span><span class="token operator">*</span>reserve<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/* reserve mem blocks    */</span>
    <span class="token keyword">void</span>            <span class="token punctuation">(</span><span class="token operator">*</span>map_io<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/* IO mapping function    */</span>
    <span class="token keyword">void</span>            <span class="token punctuation">(</span><span class="token operator">*</span>init_early<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span>            <span class="token punctuation">(</span><span class="token operator">*</span>init_irq<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">sys_timer</span>    <span class="token operator">*</span>timer<span class="token punctuation">;</span>        <span class="token comment">/* system tick timer    */</span>
    <span class="token keyword">void</span>            <span class="token punctuation">(</span><span class="token operator">*</span>init_machine<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">CONFIG_MULTI_IRQ_HANDLER</span></span>
    <span class="token keyword">void</span>            <span class="token punctuation">(</span><span class="token operator">*</span>handle_irq<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">pt_regs</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</blockquote>
<blockquote>
<pre><code class="fenced-code-block language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">__setup</span><span class="token expression"><span class="token punctuation">(</span>str<span class="token punctuation">,</span> fn<span class="token punctuation">)</span>                    </span><span class="token punctuation">\</span>
    <span class="token expression"><span class="token function">__setup_param</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> fn<span class="token punctuation">,</span> fn<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">__setup_param</span><span class="token expression"><span class="token punctuation">(</span>str<span class="token punctuation">,</span> unique_id<span class="token punctuation">,</span> fn<span class="token punctuation">,</span> early<span class="token punctuation">)</span>            </span><span class="token punctuation">\</span>
    <span class="token expression"><span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">char</span> __setup_str_</span><span class="token punctuation">##</span><span class="token expression">unique_id<span class="token punctuation">[</span><span class="token punctuation">]</span> __initconst    </span><span class="token punctuation">\</span>
        <span class="token expression"><span class="token function">__aligned</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> str<span class="token punctuation">;</span> </span><span class="token punctuation">\</span>
    <span class="token expression"><span class="token keyword">static</span> <span class="token keyword">struct</span> <span class="token class-name">obs_kernel_param</span> __setup_</span><span class="token punctuation">##</span><span class="token expression">unique_id    </span><span class="token punctuation">\</span>
        <span class="token expression">__used <span class="token function">__section</span><span class="token punctuation">(</span><span class="token punctuation">.</span>init<span class="token punctuation">.</span>setup<span class="token punctuation">)</span>            </span><span class="token punctuation">\</span>
        <span class="token expression"><span class="token keyword">__attribute__</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">aligned</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    </span><span class="token punctuation">\</span>
        <span class="token expression"><span class="token operator">=</span> <span class="token punctuation">{</span> __setup_str_</span><span class="token punctuation">##</span><span class="token expression">unique_id<span class="token punctuation">,</span> fn<span class="token punctuation">,</span> early <span class="token punctuation">}</span></span></span>

<span class="token function">__setup</span><span class="token punctuation">(</span><span class="token string">"init="</span><span class="token punctuation">,</span> init_setup<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">char</span> __setup_str_init_setup<span class="token punctuation">[</span><span class="token punctuation">]</span> \
    <span class="token function">__section</span><span class="token punctuation">(</span><span class="token punctuation">.</span>init<span class="token punctuation">.</span>rodata<span class="token punctuation">)</span>\
    <span class="token function">__aligned</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">"init="</span><span class="token punctuation">;</span> \
<span class="token keyword">static</span> <span class="token keyword">struct</span> <span class="token class-name">obs_kernel_param</span> __setup_init_setup    \
        __used <span class="token function">__section</span><span class="token punctuation">(</span><span class="token punctuation">.</span>init<span class="token punctuation">.</span>setup<span class="token punctuation">)</span>            \
        <span class="token keyword">__attribute__</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">aligned</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    \
        <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">"init="</span><span class="token punctuation">,</span> init_setup<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span>


</code></pre>
</blockquote>
<p><strong>/proc/cmdline文件存放u-boot存的参数</strong></p>
<p>内核启动流程</p>
<blockquote>
<p>第一阶段head.S</p>
<ol>
<li><p>比对两组ID</p>
</li>
<li><p>初始化A8处理器</p>
</li>
<li><p>打开mmu，建立映射表</p>
</li>
</ol>
<pre><code class="fenced-code-block language-c"><span class="token comment">//第一阶段：arch\arm\kernel\head.S</span>
    __HEAD
<span class="token function">ENTRY</span><span class="token punctuation">(</span>stext<span class="token punctuation">)</span>
    setmode    PSR_F_BIT <span class="token operator">|</span> PSR_I_BIT <span class="token operator">|</span> SVC_MODE<span class="token punctuation">,</span> r9 @ ensure svc mode
                        @ and irqs disabled
    mrc    p15<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> r9<span class="token punctuation">,</span> c0<span class="token punctuation">,</span> c0        @ get processor id
    bl    __lookup_processor_type        @ r5<span class="token operator">=</span>procinfo r9<span class="token operator">=</span>cpuid  
    bl    __create_page_tables<span class="token comment">//建立mmu映射表</span>

    <span class="token comment">/*
     * The following calls CPU specific code in a position independent
     * manner.  See arch/arm/mm/proc-*.S for details.  r10 = base of
     * xxx_proc_info structure selected by __lookup_processor_type
     * above.  On return, the CPU will be ready for the MMU to be
     * turned on, and r0 will hold the CPU control register value.
     */</span>
ldr    r13<span class="token punctuation">,</span> <span class="token operator">=</span>__mmap_switched        @ address to jump to after
__mmap_switched：<span class="token comment">//head_common.S, 会跳到第二阶段 b start_kernel</span>
                        @ mmu has been enabled
    adr    lr<span class="token punctuation">,</span> <span class="token function">BSYM</span><span class="token punctuation">(</span><span class="token number">1f</span><span class="token punctuation">)</span>            @ <span class="token keyword">return</span> <span class="token punctuation">(</span>PIC<span class="token punctuation">)</span> address
    mov    r8<span class="token punctuation">,</span> r4                @ set TTBR1 to swapper_pg_dir
 <span class="token function">ARM</span><span class="token punctuation">(</span>    add    pc<span class="token punctuation">,</span> r10<span class="token punctuation">,</span> #PROCINFO_INITFUNC    <span class="token punctuation">)</span>
 <span class="token function">THUMB</span><span class="token punctuation">(</span>    add    r12<span class="token punctuation">,</span> r10<span class="token punctuation">,</span> #PROCINFO_INITFUNC    <span class="token punctuation">)</span>
 <span class="token function">THUMB</span><span class="token punctuation">(</span>    mov    pc<span class="token punctuation">,</span> r12                <span class="token punctuation">)</span>
<span class="token number">1</span><span class="token operator">:</span>    b    __enable_mmu
<span class="token function">ENDPROC</span><span class="token punctuation">(</span>stext<span class="token punctuation">)</span>
    <span class="token punctuation">.</span>ltorg
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">CONFIG_XIP_KERNEL</span></span>
<span class="token number">2</span><span class="token operator">:</span>    <span class="token punctuation">.</span><span class="token keyword">long</span>    <span class="token punctuation">.</span>
    <span class="token punctuation">.</span><span class="token keyword">long</span>    PAGE_OFFSET
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></code></pre>
<p>第二阶段：init/main.c</p>
<p>start_kernel </p>
<pre><code class="fenced-code-block language-c">asmlinkage <span class="token keyword">void</span> __init <span class="token function">start_kernel</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
 <span class="token function">printk</span><span class="token punctuation">(</span>KERN_NOTICE <span class="token string">"%s"</span><span class="token punctuation">,</span> linux_banner<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token function">setup_arch</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>command_line<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//初始化cpu和机器代码，找到机器描述对象</span>
    <span class="token comment">//通过machineid找到对应的struct machine_desc        </span>
    <span class="token comment">//从0x30000100中获取到了u-boot传递过来的参数</span>
    mdesc <span class="token operator">=</span> <span class="token function">setup_machine_tags</span><span class="token punctuation">(</span>machine_arch_type<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//machine_arch_type=2456</span>
        <span class="token comment">//__arch_info_begin和__arch_info_end在链接脚本中定义</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>p <span class="token operator">=</span> __arch_info_begin<span class="token punctuation">;</span> p <span class="token operator">&lt;</span> __arch_info_end<span class="token punctuation">;</span> p<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>nr <span class="token operator">==</span> p<span class="token operator">-&gt;</span>nr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">printk</span><span class="token punctuation">(</span><span class="token string">"Machine: %s\n"</span><span class="token punctuation">,</span> p<span class="token operator">-&gt;</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
                mdesc <span class="token operator">=</span> p<span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> mdesc 

    machine_desc <span class="token operator">=</span> mdesc<span class="token punctuation">;</span><span class="token comment">//将遍历到的desc 赋值给machine_desc </span>
 <span class="token function">printk</span><span class="token punctuation">(</span>KERN_NOTICE <span class="token string">"Kernel command line: %s\n"</span><span class="token punctuation">,</span> boot_command_line<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">parse_early_param</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//分析u-boot传进来的每个参数</span>
    <span class="token comment">//Kernel command line: console=ttySAC2,115200 root=/dev/nfs rw nfsroot=192.100.100.14:/home/dwu/samba/nfsroot/rootfs,v3 ip=192.100.100.44:192.100.100.14:192.100.100.1:255.255.255.0::eth0:off earlyprintk init=/linuxrc</span>
    <span class="token comment">//有一个应用：在bootargs中可以自定义传递参数, 一般用于开发u-boot，给内核传各种参数</span>
    <span class="token comment">//set bootargs myname=ruhua myage=20</span>
    <span class="token comment">/*
     内核中需要拿到ruhua和20，就必须在任何一个文件中添加如下内容
     eg:在init/main.c中
    static int __init myname_setup(char *str)
    {
        printk("myname = %s \n", str);
        return 1;
    }
    __setup("myname=", myname_setup);

    static int __init myage_setup(char *str)
    {
        int age = simple_strtoul(str);
        printk("age= %d \n", age );
        return 1;
    }
    __setup("myage=", myage_setup);
    */</span>

    <span class="token function">parse_args</span><span class="token punctuation">(</span><span class="token string">"Booting kernel"</span><span class="token punctuation">,</span> static_command_line<span class="token punctuation">,</span> __start___param<span class="token punctuation">,</span>
           __stop___param <span class="token operator">-</span> __start___param<span class="token punctuation">,</span>
           <span class="token operator">&amp;</span>unknown_bootoption<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token function">rest_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//开辟3个线程</span>
<span class="token comment">//1. kernel_init  </span>
    <span class="token comment">//a. 执行所有驱动入口函数</span>
    <span class="token comment">//b. 挂载根文件系统 </span>
    <span class="token comment">//c. 执行祖先init进程</span>

    <span class="token function">kernel_thread</span><span class="token punctuation">(</span>kernel_init<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> CLONE_FS <span class="token operator">|</span> CLONE_SIGHAND<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">static</span> <span class="token keyword">int</span> __init <span class="token function">kernel_init</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span> unused<span class="token punctuation">)</span>
        <span class="token comment">//a. 执行所有驱动入口函数</span>
            <span class="token function">do_basic_setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//执行所有驱动入口函数</span>
                <span class="token function">do_initcalls</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span>fn <span class="token operator">=</span> __early_initcall_end<span class="token punctuation">;</span> fn <span class="token operator">&lt;</span> __initcall_end<span class="token punctuation">;</span> fn<span class="token operator">++</span><span class="token punctuation">)</span>
                        <span class="token function">do_one_initcall</span><span class="token punctuation">(</span><span class="token operator">*</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
                           ret <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//批量的执行了initcallX.init段中所有的函数指针</span>
                                        <span class="token comment">//也就是执行了所有的驱动入口函数</span>

dwu@atc<span class="token operator">-</span>dwu<span class="token operator">:</span><span class="token operator">~</span><span class="token operator">/</span>samba<span class="token operator">/</span>linux<span class="token operator">-</span><span class="token number">3.0</span><span class="token number">.8</span>$ grep <span class="token operator">-</span>rHn <span class="token string">"&gt;init_machine"</span> arch<span class="token operator">/</span>arm<span class="token operator">/</span>
arch<span class="token operator">/</span>arm<span class="token operator">/</span>kernel<span class="token operator">/</span>setup<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">732</span><span class="token operator">:</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>machine_desc<span class="token operator">-&gt;</span>init_machine<span class="token punctuation">)</span>
arch<span class="token operator">/</span>arm<span class="token operator">/</span>kernel<span class="token operator">/</span>setup<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">733</span><span class="token operator">:</span>        machine_desc<span class="token operator">-&gt;</span><span class="token function">init_machine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">static</span> <span class="token keyword">int</span> __init <span class="token function">customize_machine</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">/* customizes platform devices, or adds new ones */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>machine_desc<span class="token operator">-&gt;</span>init_machine<span class="token punctuation">)</span>
        machine_desc<span class="token operator">-&gt;</span><span class="token function">init_machine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
<span class="token function">arch_initcall</span><span class="token punctuation">(</span>customize_machine<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//在do_basic_setup();中调用</span>

    <span class="token comment">//b. 挂载根文件系统 </span>
    <span class="token function">prepare_namespace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//挂载根文件系统</span>

    <span class="token comment">//c. 执行祖先init进程</span>
    <span class="token function">init_post</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//执行祖先init进程</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>execute_command<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//init="/linuxrc"  execute_command = "/linuxrc"</span>
            <span class="token comment">//优先执行bootargs中指定的祖先进程</span>
            <span class="token function">run_init_process</span><span class="token punctuation">(</span>execute_command<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">printk</span><span class="token punctuation">(</span>KERN_WARNING <span class="token string">"Failed to execute %s.  Attempting "</span>
                    <span class="token string">"defaults...\n"</span><span class="token punctuation">,</span> execute_command<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//如果没有执行，就执行以下备胎；成功了就没后面的事了，因为会将该程序的各段加载到内存</span>
        <span class="token function">run_init_process</span><span class="token punctuation">(</span><span class="token string">"/sbin/init"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">run_init_process</span><span class="token punctuation">(</span><span class="token string">"/etc/init"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">run_init_process</span><span class="token punctuation">(</span><span class="token string">"/bin/init"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">run_init_process</span><span class="token punctuation">(</span><span class="token string">"/bin/sh"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">"No init found.  Try passing init= option to kernel. "</span>
              <span class="token string">"See Linux Documentation/init.txt for guidance."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        



<span class="token comment">//2. kthreadd: 创建其他线程</span>
pid <span class="token operator">=</span> <span class="token function">kernel_thread</span><span class="token punctuation">(</span>kthreadd<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> CLONE_FS <span class="token operator">|</span> CLONE_FILES<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">create_kthread</span><span class="token punctuation">(</span>create<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//死循环，创建其他内核线程</span>
<span class="token comment">//3. 主线程：睡眠</span>
<span class="token function">schedule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//让出调度权</span></code></pre>
<p>调用机器初始化的过程</p>
<p><img alt="" src="file:///F:/02-src/driver_study/mydrv/images/2022-10-01-15-55-15-image.png"></p>
</blockquote>
</article>
</body>
</html>